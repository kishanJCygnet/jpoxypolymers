import{i as x,b as P}from"./helpers.1eef9d6b.js";import{C as k}from"./Tooltip.bd71695e.js";import{C as h}from"./Table.e15759f7.js";import{a as g,b as V,c as Z}from"./Affiliate.ec4f9dd7.js";import{S as m}from"./Trash.5bc42b4f.js";import{n as u}from"./vueComponentNormalizer.a77505d6.js";import{a as v,d as q,b as W}from"./index.670b7e80.js";import{C as G}from"./Index.66ae07a9.js";import{C as J}from"./Tabs.afd356a6.js";import{C as Q}from"./Modal.354eb07f.js";import{S as X,b as N}from"./index.1a8da5ff.js";import{B as tt}from"./Editor.6ef78eaa.js";import{S as st}from"./Pencil.77e25de2.js";import{T as Y}from"./Slide.b9a2da7a.js";import{S as U}from"./Plus.63317bcc.js";const l=t=>t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),Ls={methods:{filteredSuggestionsOutbound(t){const e=t.links.suggestionsOutbound.rows,s=[];return e.forEach(n=>{this.editorIsSuggestionAlreadyAdded(n)||s.push(n)}),s},editorIsSuggestionAlreadyAdded(t){return x()?this.blockEditorIsSuggestionAlreadyAdded(t):P()?this.classicEditorIsSuggestionAlreadyAdded(t):!1},blockEditorIsSuggestionAlreadyAdded(t){const e=window.wp.data.select("core/block-editor").getBlocks();return e?this.doesBlockHaveLink(e,t):!1},doesBlockHaveLink(t,e){let s=!1;return t.forEach(n=>{s||!n.attributes||e.suggestions.forEach(i=>{const o=l(i.context.permalink.trim()),r=new RegExp(`(<a href="${o}"[^<>]*>)(.*)(</a[^<>]*>)`,"i");if(n.attributes.content&&n.attributes.content.search(r)!==-1){s=!0;return}if(!n.innerBlocks)return;this.doesBlockHaveLink(n.innerBlocks,e)&&(s=!0)})}),s},classicEditorIsSuggestionAlreadyAdded(t){let e="",s=null,n=null;if(document.querySelector("#wp-content-wrap.tmce-active")?(s=window.tinyMCE.get("content"),e=s.getContent({format:"raw"})):(n=document.querySelector("textarea#content"),e=n?n.value:""),!e)return!1;let i=!1;return t.suggestions.forEach(o=>{const r=l(o.context.permalink.trim()),a=new RegExp(`(<a href="${r}"[^<>]*>)(.*)(</a[^<>]*>)`,"i");e.search(a)!==-1&&(i=!0)}),i}}},F={methods:{findTargetBlock(t,e){const s=l(e);let n=null;return t.forEach(i=>{if(n||!i.attributes)return;if(i.attributes.content&&i.attributes.content.search(s)!==-1){n=i.clientId;return}if(!i.innerBlocks)return;const o=this.findTargetBlock(i.innerBlocks,e);o&&(n=o)}),n}}},$={mixins:[F],props:{post:{type:Object,required:!0},postIndex:{type:Number,required:!1},postId:{type:Number,required:!1},linksReport:{type:Boolean,default(){return!1}},postReport:{type:Boolean,default(){return!1}},metabox:{type:Boolean,default(){return!1}}},beforeMount(){this.$bus.$on("updatingLinks",t=>{this.wpTableLoading=t}),this.pageNumber=this.linkType?this.linkAssistant.postReport[this.linkType].totals.page:1},data(){return{tableKey:0,pageNumber:1,action:"",wpTableLoading:!1,showModal:!1,selectedRows:[],bulkOptions:[{label:this.$t.__("Delete",this.$td),value:"delete"}],strings:{frontPage:this.$t.__("Front Page",this.$tdPro),deleteLink:this.$t.__("Delete Link",this.$tdPro)},modalStrings:{areYouSureSingle:this.$t.__("Are you sure you want to delete this link?",this.$tdPro),areYouSureMultiple:this.$t.__("Are you sure you want to delete these links?",this.$tdPro),areYouSureAll:this.$t.__("Are you sure you want to delete all links?",this.$tdPro),actionCannotBeUndone:this.$t.__("This action cannot be undone.",this.$tdPro),yesSingle:this.$t.__("Yes, I want to delete this link",this.$tdPro),yesMultiple:this.$t.__("Yes, I want to delete these links",this.$tdPro),yesAll:this.$t.__("Yes, I want to delete all links",this.$tdPro),noChangedMind:this.$t.__("No, I changed my mind",this.$tdPro)}}},computed:{...v(["linkAssistant","currentPost"]),rows(){if(!this.metabox)return this.post.links[this.linkType].rows;const t=this.pageNumber===1?0:(this.pageNumber-1)*10;return this.post.links[this.linkType].rows.slice(t,t+10)}},methods:{...q("linkAssistant",["linkDelete","linksBulk","postReportPaginate","postSettingsUpdate"]),openPostReport(t){window.location.href=`#/post-report?postId=${this.postId}&initialTab=${t}`},maybeDoBulkAction({action:t,selectedRows:e}){e===!1||!t||(this.action=t,this.selectedRows=e,this.showModal=!0)},doBulkAction(){if(this.showModal=!1,!(this.selectedRows===!1||typeof this.selectedRows>"u")){if(typeof this.selectedRows=="number"){this.doDeleteLink(this.selectedRows);return}if(this.metabox&&this.linkType!=="inboundInternal"){this.idsToIndexes(this.selectedRows).forEach(e=>{this.editorRemoveLink(e)});return}this.$bus.$emit("updatingLinks",!0),this.linksBulk({postIndex:this.postIndex,postId:this.post.ID||this.currentPost.id,action:this.action,linkType:this.linkType,linkIds:this.selectedRows,linksReport:this.linksReport,postReport:this.postReport}).finally(()=>{this.$bus.$emit("updatingLinks",!1),this.$emit("linksUpdated")})}},doDeleteLink(t){const e=this.post.links[this.linkType].rows[t].id;if(!!e){if(this.metabox&&this.linkType!=="inboundInternal"){this.editorRemoveLink(t);return}this.$bus.$emit("updatingLinks",!0),this.linkDelete({postIndex:this.postIndex,postId:this.post.ID||this.currentPost.id,linkId:e,linksReport:this.linksReport,postReport:this.postReport}).finally(()=>{this.$bus.$emit("updatingLinks",!1),this.$emit("linksUpdated")})}},processPagination(t){this.tableKey++,this.pageNumber=t,!this.metabox&&(this.$bus.$emit("updatingLinks",!0),this.postReportPaginate({page:t,postId:this.post.ID,postIndex:this.postIndex,type:this.linkType}).finally(()=>{this.$bus.$emit("updatingLinks",!1)}))},editorRemoveLink(t){x()&&(this.$bus.$emit("updatingLinks",!1),this.blockEditorRemoveLink(t),this.$bus.$emit("updatingLinks",!1)),P()&&this.classicEditorRemoveLink(t)},blockEditorRemoveLink(t){const e=this.currentPost.linkAssistant.links[this.linkType].rows[t];if(!e)return;this.$bus.$emit("updatingLinks",!0);const s=l(e.anchor.trim()),n=e.phrase_html.trim(),i=l(n),o=window.wp.data.select("core/block-editor").getBlocks(),r=this.findTargetBlock(o,n);if(!r){this.$bus.$emit("updatingLinks",!1);return}const a=window.wp.data.select("core/block-editor").getBlock(r);if(!a){this.$bus.$emit("updatingLinks",!1);return}let c=new RegExp(`(<t?a[^<>]*>)(.*)?(${s})(.*)?(</t?a[^<>]*>)`,"i");const d=n.replace(c,"$2$3$4");c=new RegExp(`${i}`,"i"),window.wp.data.dispatch("core/block-editor").updateBlockAttributes(r,{content:a.attributes.content.replace(c,d)}).then(()=>{this.$delete(this.post.links[this.linkType].rows,t)}).catch(f=>{console.error(`Couldn	 delete link with type "${this.linkType}" and index ${t}:`,f)}).finally(()=>{this.$bus.$emit("updatingLinks",!1),this.$emit("linksUpdated")})},classicEditorRemoveLink(t){const e=this.currentPost.linkAssistant.links[this.linkType].rows[t];if(!e||!window.tinyMCE)return;this.$bus.$emit("updatingLinks",!0);let s="",n=null,i=null;if(document.querySelector("#wp-content-wrap.tmce-active")?(n=window.tinyMCE.get("content"),s=n.getContent({format:"raw"})):(i=document.querySelector("textarea#content"),s=i?i.value:""),!s){this.$bus.$emit("updatingLinks",!1);return}let o=e.phrase_html.trim();n||(o=o.replace(/(\sdata-mce-href=".*")/gi,""));const r=l(e.anchor.trim());let a=new RegExp(`(<t?a[^<>]*>)(.*)?(${r})(.*)?(</t?a[^<>]*>)`,"i");const c=o.replace(a,"$2$3$4"),d=l(o);a=new RegExp(`${d}`,"i"),s=s.replace(a,c),n?n.setContent(s):i.value=s,this.$delete(this.post.links[this.linkType].rows,t),this.postSettingsUpdate({postContent:s}).finally(()=>{this.$bus.$emit("updatingLinks",!1),this.$emit("linksUpdated")})},idsToIndexes(t){let e,s=[];return Array.isArray(t)&&(e=t.map(Number)),e&&this.post.links[this.linkType].rows.forEach((n,i)=>{e.includes(n.id)&&s.push(i)}),t==="all"&&(s=this.post.links[this.linkType].rows.map((n,i)=>i)),s.sort(function(n,i){return i-n})}}};var et=function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.showModal?s("core-modal",{staticClass:"aioseo-confirmation-modal",attrs:{"no-header":""},scopedSlots:t._u([{key:"body",fn:function(){return[s("div",{staticClass:"aioseo-modal-body"},[s("button",{staticClass:"close",on:{click:function(n){return n.stopPropagation(),t.$emit("closeModal",!0)}}},[s("svg-close",{on:{click:function(n){return t.$emit("closeModal",!0)}}})],1),s("h3",[t._v(t._s(t.areYouSure))]),s("div",{staticClass:"reset-description",domProps:{innerHTML:t._s(t.strings.actionCannotBeUndone)}}),s("base-button",{attrs:{type:"blue",size:"medium"},on:{click:function(n){return t.$emit("doBulkAction",n)}}},[t._v(" "+t._s(t.confirmation)+" ")]),s("base-button",{attrs:{type:"gray",size:"medium"},on:{click:function(n){return t.$emit("closeModal",!0)}}},[t._v(" "+t._s(t.strings.noChangedMind)+" ")])],1)]},proxy:!0}],null,!1,3343467816)}):t._e()},nt=[];const it={components:{CoreModal:Q,SvgClose:X},props:{showModal:{type:Boolean,required:!0},selectedRows:{required:!0},strings:{type:Object,required:!0}},computed:{areYouSure(){return this.selectedRows==="all"?this.strings.areYouSureAll:Array.isArray(this.selectedRows)&&1<this.selectedRows.length?this.strings.areYouSureMultiple:this.strings.areYouSureSingle},confirmation(){return this.selectedRows==="all"?this.strings.yesAll:Array.isArray(this.selectedRows)&&1<this.selectedRows.length?this.strings.yesMultiple:this.strings.yesSingle}}},R={};var ot=u(it,et,nt,!1,rt,null,null,null);function rt(t){for(let e in R)this[e]=R[e]}const _=function(){return ot.exports}();var at=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"aioseo-link-assistant-phrase",on:{mouseover:function(n){return t.$emit("mouseOver")},mouseleave:function(n){return t.$emit("mouseLeave")}}},[s("span",{staticClass:"phrase"},[s("span",{staticClass:"first"},[t._v(t._s(t.firstPart))]),t.tooltip?s("core-tooltip",{attrs:{type:"action"},scopedSlots:t._u([{key:"tooltip",fn:function(){return[s("a",{staticClass:"tooltip-url",attrs:{href:t.url,target:"_blank"}},[t._v(t._s(t.url))])]},proxy:!0}],null,!1,3985851943)},[s("span",{staticClass:"anchor",on:{click:t.maybeOpenLink}},[t._v(t._s(t.linkAnchor))])]):t._e(),t.tooltip?t._e():s("div",[s("span",{staticClass:"anchor"},[t._v(t._s(t.linkAnchor))])]),s("span",{staticClass:"last"},[t._v(t._s(t.lastPart))])],1),t._t("icons")],2)},lt=[];const ut={components:{CoreTooltip:k},props:{phrase:{type:String,required:!0},phraseHtml:{type:String,required:!0},anchor:{type:String,required:!0},url:{type:String,required:!0},tooltip:{type:Boolean,required:!1,default:!0},clickableAnchor:{type:Boolean,default(){return!1}}},computed:{partPattern(){const t=l(this.anchor);return new RegExp(`(.*)(<t?a[^>]*>.*${t}.*</t?a>)(.*)`,"i")},firstPart(){return this.stripTags(this.getPart(1))},linkAnchor(){return this.stripTags(this.getPart(2))},lastPart(){return this.stripTags(this.getPart(3))}},methods:{getPart(t){const e=this.phraseHtml.match(this.partPattern);return e?e[t]:""},stripTags(t){return t.replace(/(<([^>]+)>)/gi,"")},maybeOpenLink(){this.clickableAnchor&&window.open(this.url,"_blank").focus()}}},S={};var ct=u(ut,at,lt,!1,dt,null,null,null);function dt(t){for(let e in S)this[e]=S[e]}const b=function(){return ct.exports}();var pt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("core-wp-table",{key:t.tableKey,class:{"link-assistant-inner-table":!t.postReport},attrs:{columns:t.columns,rows:t.rows,totals:t.post.links.affiliate.totals,"bulk-options":t.bulkOptions,showSearch:!1,showPagination:!t.linksReport,showTableFooter:t.postReport,loading:t.wpTableLoading},on:{"process-bulk-action":t.maybeDoBulkAction,paginate:t.processPagination},scopedSlots:t._u([{key:"phrase",fn:function(n){var i=n.row;return[s("link-assistant-phrase",{attrs:{phrase:i.phrase,phraseHtml:i.phrase_html,anchor:i.anchor,url:i.url,clickableAnchor:!0}})]}},{key:"created",fn:function(n){var i=n.column;return[t._v(" "+t._s(t.$moment.utc(i).tz(t.$moment.tz.guess()).format("MMMM D, YYYY"))+" ")]}},{key:"delete",fn:function(n){var i=n.index;return[s("core-tooltip",{attrs:{type:"action"},scopedSlots:t._u([{key:"tooltip",fn:function(){return[t._v(" "+t._s(t.strings.deleteLink)+" ")]},proxy:!0}],null,!0)},[s("svg-trash",{nativeOn:{click:function(o){return t.maybeDoBulkAction({action:"delete",selectedRows:i})}}})],1)]}}])}),t.postReport?t._e():s("div",{staticClass:"links-bottom"},[s("div",{staticClass:"links-bottom-left"},[t.post.links.affiliate.totals.total>5&&t.postReport?s("div",[s("svg-link-external"),s("a",{staticClass:"link-view",attrs:{href:"#"},on:{click:function(n){return n.preventDefault(),t.openPostReport("affiliate")}}},[t._v(" "+t._s(t.seeAllLinks)+" ")])],1):t._e()]),s("div",{staticClass:"links-bottom-right"},[t.post.links.affiliate.rows.length?s("a",{staticClass:"link-delete",on:{click:function(n){return n.preventDefault(),t.maybeDoBulkAction({action:"delete",selectedRows:"all"})}}},[t._v(" "+t._s(t.strings.deleteAllLinks)+" ")]):t._e()])]),s("link-assistant-confirmation-modal",{attrs:{showModal:t.showModal,selectedRows:t.selectedRows,strings:t.modalStrings},on:{doBulkAction:t.doBulkAction,closeModal:function(n){t.showModal=!1}}})],1)},ht=[];const gt={components:{CoreTooltip:k,CoreWpTable:h,LinkAssistantConfirmationModal:_,LinkAssistantPhrase:b,SvgLinkExternal:g,SvgTrash:m},mixins:[$],data(){return{linkType:"affiliate",strings:{deleteAllLinks:this.$t.sprintf(this.$t.__("Delete All %1$s Links",this.$td),this.$t.__("Affiliate",this.$tdPro))}}},computed:{columns(){return[{slug:"phrase",label:this.$t.__("Phrase",this.$td)},{slug:"delete",width:"50px"}]},seeAllLinks(){return this.$t.sprintf(this.$t.__("See All %1$s %2$s Links",this.$td),this.post.links.affiliate.totals.total,this.$t.__("Affiliate",this.$tdPro))}}},A={};var _t=u(gt,pt,ht,!1,ft,null,null,null);function ft(t){for(let e in A)this[e]=A[e]}const Ms=function(){return _t.exports}();var kt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("core-wp-table",{key:t.tableKey,class:{"link-assistant-inner-table":!t.postReport},attrs:{columns:t.columns,rows:t.rows,totals:t.post.links.external.totals,"bulk-options":t.bulkOptions,showSearch:!1,showPagination:!t.linksReport,showTableFooter:t.postReport,loading:t.wpTableLoading,initialPageNumber:t.pageNumber},on:{"process-bulk-action":t.maybeDoBulkAction,paginate:t.processPagination},scopedSlots:t._u([{key:"phrase",fn:function(n){var i=n.row;return[s("link-assistant-phrase",{attrs:{phrase:i.phrase,phraseHtml:i.phrase_html,anchor:i.anchor,url:i.url,clickableAnchor:!0}})]}},{key:"created",fn:function(n){var i=n.column;return[t._v(" "+t._s(t.$moment.utc(i).tz(t.$moment.tz.guess()).format("MMMM D, YYYY"))+" ")]}},{key:"delete",fn:function(n){var i=n.index;return[s("core-tooltip",{attrs:{type:"action"},scopedSlots:t._u([{key:"tooltip",fn:function(){return[t._v(" "+t._s(t.strings.deleteLink)+" ")]},proxy:!0}],null,!0)},[s("svg-trash",{nativeOn:{click:function(o){return t.maybeDoBulkAction({action:"delete",selectedRows:i})}}})],1)]}}])}),t.postReport?t._e():s("div",{staticClass:"links-bottom"},[s("div",{staticClass:"links-bottom-left"},[t.post.links.external.totals.total>5&&t.linksReport?s("div",[s("svg-link-external"),s("a",{staticClass:"link-view",attrs:{href:"#"},on:{click:function(n){return n.preventDefault(),t.openPostReport("external")}}},[t._v(" "+t._s(t.seeAllLinks)+" ")])],1):t._e()]),s("div",{staticClass:"links-bottom-right"},[t.post.links.external.rows.length?s("a",{staticClass:"link-delete",on:{click:function(n){return n.preventDefault(),t.maybeDoBulkAction({action:"delete",selectedRows:"all"})}}},[t._v(" "+t._s(t.strings.deleteAllLinks)+" ")]):t._e()])]),s("link-assistant-confirmation-modal",{attrs:{showModal:t.showModal,selectedRows:t.selectedRows,strings:t.modalStrings},on:{doBulkAction:t.doBulkAction,closeModal:function(n){t.showModal=!1}}})],1)},mt=[];const vt={components:{CoreTooltip:k,CoreWpTable:h,LinkAssistantConfirmationModal:_,LinkAssistantPhrase:b,SvgLinkExternal:g,SvgTrash:m},mixins:[$],data(){return{linkType:"external",strings:{deleteAllLinks:this.$t.sprintf(this.$t.__("Delete All %1$s Links",this.$td),this.$t.__("External",this.$tdPro))}}},computed:{columns(){return[{slug:"phrase",label:this.$t.__("Phrase",this.$td)},{slug:"delete",width:"50px"}]},seeAllLinks(){return this.$t.sprintf(this.$t.__("See All %1$s %2$s Links",this.$td),this.post.links.external.totals.total,this.$t.__("External",this.$tdPro))}}},C={};var $t=u(vt,kt,mt,!1,bt,null,null,null);function bt(t){for(let e in C)this[e]=C[e]}const Es=function(){return $t.exports}(),w={methods:{viewPost(t){return this.$t.sprintf(this.$t.__("View %1$s",this.$td),t)},editPost(t){return this.$t.sprintf(this.$t.__("Edit %1$s",this.$td),t)}}};var wt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("svg",{staticClass:"aioseo-link-suggestion",attrs:{viewBox:"0 0 17 10",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[s("path",{attrs:{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M7.66699 7.43742H4.33366C2.95866 7.43742 1.83366 6.31242 1.83366 4.93742C1.83366 3.56242 2.95866 2.43742 4.33366 2.43742H7.66699V0.770752H4.33366C2.03366 0.770752 0.166992 2.63742 0.166992 4.93742C0.166992 7.23742 2.03366 9.10408 4.33366 9.10408H7.66699V7.43742ZM12.667 0.770752H9.33366V2.43742H12.667C14.042 2.43742 15.167 3.56242 15.167 4.93742C15.167 6.31242 14.042 7.43742 12.667 7.43742H9.33366V9.10408H12.667C14.967 9.10408 16.8337 7.23742 16.8337 4.93742C16.8337 2.63742 14.967 0.770752 12.667 0.770752ZM11.8337 4.10409H5.16699V5.77075H11.8337V4.10409Z",fill:"currentColor"}})])},yt=[];const xt={},T={};var Pt=u(xt,wt,yt,!1,Rt,null,null,null);function Rt(t){for(let e in T)this[e]=T[e]}const K=function(){return Pt.exports}();var St=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("core-wp-table",{class:{"link-assistant-inner-table":!t.postReport},attrs:{columns:t.columns,rows:t.rows,totals:t.post.links.inboundInternal.totals,"bulk-options":t.bulkOptions,showSearch:!1,showPagination:!t.linksReport,showTableFooter:t.postReport,loading:t.wpTableLoading},on:{"process-bulk-action":t.maybeDoBulkAction,paginate:t.processPagination},scopedSlots:t._u([{key:"post_title",fn:function(n){var i=n.row;return[s("span",[t._v(" "+t._s(i.context.postTitle)+" "),i.context.permalink.replace(/\/$/,"")===t.$aioseo.urls.home?s("span",[t._v("("+t._s(t.strings.frontPage)+")")]):t._e()]),i.context?s("div",{staticClass:"row-actions"},[s("span",{staticClass:"view"},[s("a",{attrs:{href:i.context.permalink,target:"_blank"}},[t._v(t._s(t.maybeViewPost(i)))]),t._v(" | ")]),s("span",{staticClass:"edit"},[s("a",{attrs:{href:i.context.editLink,target:"_blank"}},[t._v(t._s(t.maybeEditPost(i)))])])]):t._e()]}},{key:"phrase",fn:function(n){var i=n.row;return[s("link-assistant-phrase",{attrs:{phrase:i.phrase,phraseHtml:i.phrase_html||"",anchor:i.anchor,url:i.url,clickableAnchor:!0}})]}},{key:"delete",fn:function(n){var i=n.index;return[s("core-tooltip",{attrs:{type:"action"},scopedSlots:t._u([{key:"tooltip",fn:function(){return[t._v(" "+t._s(t.strings.deleteLink)+" ")]},proxy:!0}],null,!0)},[s("svg-trash",{nativeOn:{click:function(o){return t.maybeDoBulkAction({action:"delete",selectedRows:i})}}})],1)]}}])}),t.postReport?t._e():s("div",{staticClass:"links-bottom"},[s("div",{staticClass:"links-bottom-left"},[t.post.links.inboundInternal.rows.length?s("base-button",{attrs:{type:"blue",tag:"button"},nativeOn:{click:function(n){return t.$emit("openSuggestions")}}},[s("svg-link-suggestion"),t._v(" "+t._s(t.strings.outboundSuggestions)+" ")],1):t._e(),t.post.links.inboundInternal.totals.total>5&&t.linksReport?s("div",[s("svg-link-external"),s("a",{staticClass:"link-view",attrs:{href:"#"},on:{click:function(n){return n.preventDefault(),t.openPostReport("inbound-internal")}}},[t._v(" "+t._s(t.seeAllLinks)+" ")])],1):t._e()],1),s("div",{staticClass:"links-bottom-right"},[t.post.links.inboundInternal.rows.length?s("a",{staticClass:"link-delete",on:{click:function(n){return n.preventDefault(),t.maybeDoBulkAction({action:"delete",selectedRows:"all"})}}},[t._v(" "+t._s(t.strings.deleteAllLinks)+" ")]):t._e()])]),s("link-assistant-confirmation-modal",{attrs:{showModal:t.showModal,selectedRows:t.selectedRows,strings:t.modalStrings},on:{doBulkAction:t.doBulkAction,closeModal:function(n){t.showModal=!1}}})],1)},At=[];const Ct={components:{CoreTooltip:k,CoreWpTable:h,LinkAssistantConfirmationModal:_,LinkAssistantPhrase:b,SvgLinkExternal:g,SvgLinkSuggestion:K,SvgTrash:m},mixins:[$,w],data(){return{linkType:"inboundInternal",strings:{deleteAllLinks:this.$t.sprintf(this.$t.__("Delete All %1$s Links",this.$td),this.$t.__("Inbound Internal",this.$td)),outboundSuggestions:this.$t.sprintf(this.$t.__("%1$s Link Suggestions",this.$td),this.$t.__("Inbound",this.$td))}}},computed:{columns(){return[{slug:"post_title",label:this.$t.__("Post Title",this.$td)},{slug:"phrase",label:this.$t.__("Phrase",this.$td)},{slug:"delete",width:"50px"}]},seeAllLinks(){return this.$t.sprintf(this.$t.__("See All %1$s %2$s Links",this.$td),this.post.links.inboundInternal.totals.total,this.$t.__("Inbound Internal",this.$td))}},methods:{maybeViewPost(t){var e,s;this.viewPost(((s=(e=t.context)==null?void 0:e.postType)==null?void 0:s.singular)||"Post")},maybeEditPost(t){var e,s;this.editPost(((s=(e=t.context)==null?void 0:e.postType)==null?void 0:s.singular)||"Post")}}},I={};var Tt=u(Ct,St,At,!1,It,null,null,null);function It(t){for(let e in I)this[e]=I[e]}const Bs=function(){return Tt.exports}();var Lt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("core-wp-table",{class:{"link-assistant-inner-table":!t.postReport},attrs:{columns:t.columns,rows:t.rows,totals:t.post.links.outboundInternal.totals,"bulk-options":t.bulkOptions,showSearch:!1,showPagination:!t.linksReport,showTableFooter:t.postReport,loading:t.wpTableLoading},on:{"process-bulk-action":t.maybeDoBulkAction,paginate:t.processPagination},scopedSlots:t._u([{key:"post_title",fn:function(n){var i=n.row;return[i.context&&i.context.postTitle?s("span",[t._v(" "+t._s(i.context.postTitle)+" "),i.url.replace(/\/$/,"")===t.$aioseo.urls.home?s("span",[t._v("("+t._s(t.strings.frontPage)+")")]):t._e()]):t._e(),!i.context||!i.context.postTitle?s("span",[t._v(" "+t._s(i.url)+" "),i.url.replace(/\/$/,"")===t.$aioseo.urls.home?s("span",[t._v("("+t._s(t.strings.frontPage)+")")]):t._e()]):t._e(),i.context?s("div",{staticClass:"row-actions"},[s("span",{staticClass:"view"},[s("a",{attrs:{href:i.url,target:"_blank"}},[t._v(t._s(t.viewPost(i.context.postType.singular)))]),t._v(" | ")]),s("span",{staticClass:"edit"},[s("a",{attrs:{href:i.context.editLink,target:"_blank"}},[t._v(t._s(t.editPost(i.context.postType.singular)))])])]):t._e(),i.context?t._e():s("div",{staticClass:"row-actions"},[s("span",{staticClass:"view"},[s("a",{attrs:{href:i.url,target:"_blank"}},[t._v(t._s(t.strings.openUrl))])])])]}},{key:"phrase",fn:function(n){var i=n.row;return[s("link-assistant-phrase",{attrs:{phrase:i.phrase,phraseHtml:i.phrase_html,anchor:i.anchor,url:i.url,clickableAnchor:!0}})]}},{key:"created",fn:function(n){var i=n.column;return[t._v(" "+t._s(t.$moment.utc(i).tz(t.$moment.tz.guess()).format("MMMM D, YYYY"))+" ")]}},{key:"delete",fn:function(n){var i=n.index;return[s("core-tooltip",{attrs:{type:"action"},scopedSlots:t._u([{key:"tooltip",fn:function(){return[t._v(" "+t._s(t.strings.deleteLink)+" ")]},proxy:!0}],null,!0)},[s("svg-trash",{nativeOn:{click:function(o){return t.maybeDoBulkAction({action:"delete",selectedRows:i})}}})],1)]}}])}),t.postReport?t._e():s("div",{staticClass:"links-bottom"},[s("div",{staticClass:"links-bottom-left"},[t.post.links.outboundInternal.rows.length?s("base-button",{attrs:{type:"blue",tag:"button"},nativeOn:{click:function(n){return t.$emit("openSuggestions")}}},[s("svg-link-suggestion"),t._v(" "+t._s(t.strings.outboundSuggestions)+" ")],1):t._e(),t.post.links.outboundInternal.totals.total>5&&t.linksReport?s("div",[s("svg-link-external"),s("a",{staticClass:"link-view",attrs:{href:"#"},on:{click:function(n){return n.preventDefault(),t.openPostReport("outbound-internal")}}},[t._v(" "+t._s(t.seeAllLinks)+" ")])],1):t._e()],1),s("div",{staticClass:"links-bottom-right"},[t.post.links.outboundInternal.rows.length?s("a",{staticClass:"link-delete",on:{click:function(n){return n.preventDefault(),t.maybeDoBulkAction({action:"delete",selectedRows:"all"})}}},[t._v(" "+t._s(t.strings.deleteAllLinks)+" ")]):t._e()])]),s("link-assistant-confirmation-modal",{attrs:{showModal:t.showModal,selectedRows:t.selectedRows,strings:t.modalStrings},on:{doBulkAction:t.doBulkAction,closeModal:function(n){t.showModal=!1}}})],1)},Mt=[];const Et={components:{CoreTooltip:k,CoreWpTable:h,LinkAssistantConfirmationModal:_,LinkAssistantPhrase:b,SvgLinkExternal:g,SvgLinkSuggestion:K,SvgTrash:m},mixins:[$,w],data(){return{linkType:"outboundInternal",strings:{deleteAllLinks:this.$t.sprintf(this.$t.__("Delete All %1$s Links",this.$td),this.$t.__("Outbound Internal",this.$tdPro)),outboundSuggestions:this.$t.sprintf(this.$t.__("%1$s Link Suggestions",this.$td),this.$t.__("Outbound",this.$tdPro)),openUrl:this.$t.__("Open URL",this.$tdPro)}}},computed:{columns(){return[{slug:"post_title",label:this.$t.__("Post Title / URL",this.$tdPro)},{slug:"phrase",label:this.$t.__("Phrase",this.$td)},{slug:"delete",width:"50px"}]},seeAllLinks(){return this.$t.sprintf(this.$t.__("See All %1$s %2$s Links",this.$td),this.post.links.outboundInternal.totals.total,this.$t.__("Outbound Internal",this.$tdPro))}}},L={};var Bt=u(Et,Lt,Mt,!1,Dt,null,null,null);function Dt(t){for(let e in L)this[e]=L[e]}const Ds=function(){return Bt.exports}(),j={mixins:[F],props:{post:{type:Object,required:!0},postIndex:{type:Number,required:!1},postId:{type:Number,required:!1},filteredSuggestionsOutbound:{type:Array,required:!1},postReport:{type:Boolean,default(){return!1}},linksReport:{type:Boolean,default(){return!1}},metabox:{type:Boolean,default(){return!1}}},beforeMount(){this.$bus.$on("updatingLinks",t=>{this.wpTableLoading=t}),this.pageNumber=this.suggestionType?this.linkAssistant.postReport[this.suggestionType].totals.page:1},data(){return{tableKey:0,pageNumber:1,editablePhraseKey:0,activeSuggestionRow:-1,action:"",showModal:!1,wpTableLoading:!1,selectedRows:[],bulkOptions:[{label:this.$t.__("Add Link",this.$tdPro),value:"add"},{label:this.$t.__("Description",this.$td),value:"dismiss"}],strings:{addLink:this.$t.__("Add Link",this.$tdPro),dismiss:this.$t.__("Dismiss Suggestion",this.$tdPro)}}},computed:{...v(["linkAssistant","currentPost"]),rows(){if(!this.metabox)return this.post.links[this.suggestionType].rows;const t=this.pageNumber===1?0:(this.pageNumber-1)*10;return this.suggestionType==="suggestionsOutbound"?this.filteredSuggestionsOutbound.slice(t,t+10):this.post.links[this.suggestionType].rows.slice(t,t+10)},modalStrings(){return this.action==="add"?{areYouSureSingle:this.$t.__("Are you sure you want to add this suggestion?",this.$tdPro),areYouSureMultiple:this.$t.__("Are you sure you want to add these suggestions?",this.$tdPro),areYouSureAll:this.$t.__("Are you sure you want to add all suggestions?",this.$tdPro),actionCannotBeUndone:this.$t.__("This action cannot be undone.",this.$tdPro),yesSingle:this.$t.__("Yes, I want to add this suggestion",this.$tdPro),yesMultiple:this.$t.__("Yes, I want to add these suggestions",this.$tdPro),yesAll:this.$t.__("Yes, I want to add all suggestions",this.$tdPro),noChangedMind:this.$t.__("No, I changed my mind",this.$tdPro)}:{areYouSureSingle:this.$t.__("Are you sure you want to dismiss this suggestion?",this.$tdPro),areYouSureMultiple:this.$t.__("Are you sure you want to dismiss these suggestions?",this.$tdPro),areYouSureAll:this.$t.__("Are you sure you want to dismiss all suggestions?",this.$tdPro),actionCannotBeUndone:this.$t.__("This action cannot be undone.",this.$tdPro),yesSingle:this.$t.__("Yes, I want to dismiss this suggestion",this.$tdPro),yesMultiple:this.$t.__("Yes, I want to dismiss these suggestions",this.$tdPro),yesAll:this.$t.__("Yes, I want to dismiss all suggestions",this.$tdPro),noChangedMind:this.$t.__("No, I changed my mind",this.$tdPro)}}},methods:{...q("linkAssistant",["suggestionDismiss","suggestionsBulk","postReportPaginate","postSettingsUpdate"]),toggleShowMorePhrases(t){if(this.activeSuggestionRow===t){this.activeSuggestionRow=-1;return}this.activeSuggestionRow=t},toggleShowMorePostTitles(t){if(this.activeSuggestionRow===t){this.activeSuggestionRow=-1;return}this.activeSuggestionRow=t},openPostReport(t,e){window.location.href=`#/post-report?postId=${this.postId}&initialTab=${t}&initialSuggestionTab=${e}`},saveModifiedPhrase(t){let e=null;this.linksReport&&(e=this.linkAssistant.linksReport.rows[this.postIndex].links[this.suggestionType].rows[t.postIndex]),this.postReport&&(e=this.linkAssistant.postReport[this.suggestionType].rows[t.postIndex]),this.metabox&&(e=this.currentPost.linkAssistant.links[this.suggestionType].rows[t.postIndex]),e.suggestions[t.phraseIndex].phrase_html!==t.phraseHtml&&(e.suggestions[t.phraseIndex].phrase=t.phrase,e.suggestions[t.phraseIndex].phrase_html=t.phraseHtml,e.suggestions[t.phraseIndex].anchor=t.anchor)},addLink(t,e){let s=null;if(this.suggestionType==="suggestionsInbound"){const i=`editablePhrase${e}`;s=this.$refs[i].selectedPhrase}if(this.suggestionType==="suggestionsOutbound"&&(s=this.selectedPostTitleIndex),s===!1||typeof s>"u"){console.error("Couldn't determine index of suggestion.");return}if(this.suggestionType==="suggestionsOutbound"){const i=l(t.suggestions[0].context.permalink),o=l(t.suggestions[s].context.permalink),r=new RegExp(`/${i}/`,"i"),a=t.suggestions[0].phrase_html.replace(r,o);t.suggestions[s].phrase_html=a,t.suggestions[s].anchor=t.suggestions[0].anchor}const n=t.suggestions[s];t.suggestions[s]=t.suggestions[0],t.suggestions[0]=n,this.maybeDoBulkAction({action:"add",selectedRows:t})},maybeDoBulkAction({action:t,selectedRows:e}){e===!1||e===void 0||!t||(this.action=t,this.selectedRows=e,this.showModal=!0)},doBulkAction(){if(this.showModal=!1,!this.selectedRows)return;if(this.action==="dismiss"&&typeof this.selectedRows=="number"){this.doDismissSuggestion(this.selectedRows);return}if(this.selectedRows==="all"){this.$bus.$emit("updatingLinks",!0),this.suggestionsBulk({postIndex:this.postIndex,postId:this.post.ID||this.currentPost.id,action:this.action,suggestionType:this.suggestionType,suggestionRows:"all",linksReport:this.linksReport,postReport:this.postReport}).finally(()=>{this.$bus.$emit("updatingLinks",!1),this.$emit("linksUpdated")});return}let t=null;if(this.linksReport&&(t=this.linkAssistant.linksReport.rows[this.postIndex].links[this.suggestionType].rows),this.postReport&&(t=this.linkAssistant.postReport[this.suggestionType].rows),this.metabox){if(this.action==="add"&&this.suggestionType!=="suggestionsInbound"){if(this.$bus.$emit("updatingLinks",!0),Array.isArray(this.selectedRows))this.selectedRows.forEach(s=>{this.editorAddSuggestion(s)});else{const s=this.selectedRows;this.editorAddSuggestion(s)}this.$bus.$emit("updatingLinks",!1);return}t=this.currentPost.linkAssistant.links[this.suggestionType].rows}const e=[];Array.isArray(this.selectedRows)?this.selectedRows.forEach(s=>{e.push(t[s])}):e.push(this.selectedRows),this.$bus.$emit("updatingLinks",!0),this.suggestionsBulk({postIndex:this.postIndex,postId:this.post.ID||this.currentPost.id,action:this.action,suggestionType:this.suggestionType,suggestionRows:e,linksReport:this.linksReport,postReport:this.postReport}).finally(()=>{this.$bus.$emit("updatingLinks",!1),this.$emit("linksUpdated")})},doDismissSuggestion(t){this.$bus.$emit("updatingLinks",!0),this.suggestionDismiss({postIndex:this.postIndex,postId:this.post.ID||this.currentPost.id,suggestionId:t,linksReport:this.linksReport,postReport:this.postReport}).finally(()=>{this.$bus.$emit("updatingLinks",!1),this.$emit("linksUpdated")})},processPagination(t){this.tableKey++,this.pageNumber=t,!this.metabox&&(this.$bus.$emit("updatingLinks",!0),this.postReportPaginate({page:t,postId:this.post.ID,postIndex:this.postIndex,type:this.suggestionType}).finally(()=>{this.$bus.$emit("updatingLinks",!1)}))},editorAddSuggestion(t){x()&&this.blockEditorAddSuggestion(t),P()&&this.classicEditorAddSuggestion(t)},blockEditorAddSuggestion(t){let e=null,s=null;if(isNaN(t)?this.rows.forEach((p,y)=>{p.suggestions[0].id===t.suggestions[0].id&&(e=p,s=y)}):(s=t,e=this.rows[t]),!e||s===!1)return;this.$bus.$emit("updatingLinks",!0);const n=window.wp.data.select("core/block-editor").getBlocks(),i=e.suggestions[0].original_phrase_html.trim(),o=this.findTargetBlock(n,i);if(!o){this.$bus.$emit("updatingLinks",!1);return}const r=window.wp.data.select("core/block-editor").getBlock(o);if(!r){this.$bus.$emit("updatingLinks",!1);return}const a=l(e.suggestions[0].anchor.trim());let c=new RegExp(`(${a})`,"i");const d=e.suggestions[0].phrase_html.trim(),f=l(i);c=new RegExp(`(${f})`,"i"),window.wp.data.dispatch("core/block-editor").updateBlockAttributes(o,{content:r.attributes.content.replace(c,d)}).then(()=>{this.$delete(this.rows,s)}).catch(p=>{console.error("Couldn't add outbound link:",p)}).finally(()=>{this.postSettingsUpdate({postContent:window.wp.data.select("core/editor").getEditedPostContent(),skipNextRun:!0})})},classicEditorAddSuggestion(t){let e=null,s=null;if(isNaN(t)?this.rows.forEach((p,y)=>{p.suggestions[0].id===t.suggestions[0].id&&(e=p,s=y)}):(s=t,e=this.rows[t]),!e||s===!1)return;this.$bus.$emit("updatingLinks",!0);let n="",i=null,o=null;if(document.querySelector("#wp-content-wrap.tmce-active")?(i=window.tinyMCE.get("content"),n=i.getContent({format:"raw"})):(o=document.querySelector("textarea#content"),n=o?o.value:""),!n){this.$bus.$emit("updatingLinks",!1);return}const r=e.suggestions[0].original_phrase_html.trim(),a=l(r),c=l(e.suggestions[0].anchor.trim());let d=new RegExp(`(${c})`,"i");const f=e.suggestions[0].phrase_html.trim();d=new RegExp(`(${a})`,"i"),n=n.replace(d,f),i?i.setContent(n):o.value=n,this.$delete(this.rows,s),this.postSettingsUpdate({postContent:n,skipNextRun:!0}).finally(()=>{this.$bus.$emit("updatingLinks",!1)})}}};var Ot=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"aioseo-phrase-editor"},[t.context?s("div",{staticClass:"context"},[s("p",[s("strong",{staticClass:"context-label"},[t._v(t._s(t.strings.context)+":")])]),s("p",{domProps:{innerHTML:t._s(t.context)}})]):t._e(),s("base-editor",{ref:"linkEditor",attrs:{"auto-link":{url:t.url,phrase:t.phrase},"show-toolbar":"","allow-tags":""},on:{input:function(n){return t.$emit("input",n)},"selection-change":t.selectionChange}}),s("div",{staticClass:"action-buttons"},[s("base-button",{attrs:{type:"blue",size:"small"},on:{click:function(n){return t.$emit("saveEditor")}}},[t._v(" "+t._s(t.strings.saveChanges)+" ")]),s("base-button",{attrs:{type:"gray",size:"small"},on:{click:function(n){return t.$emit("closeEditor")}}},[t._v(" "+t._s(t.strings.cancel)+" ")])],1)],1)},Ht=[];const qt={components:{BaseEditor:tt},props:{phrase:{type:String,required:!0},url:{type:String,required:!0},context:{type:String,required:!1}},data(){return{strings:{saveChanges:this.$t.__("Save Changes",this.$tdPro),cancel:this.$t.__("Cancel",this.$tdPro),context:this.$t.__("Context",this.$tdPro)}}},mounted(){this.$refs.linkEditor.setPhrase(this.phrase);const t=document.querySelector(".ql-autoLink");t&&(t.innerHTML='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="7" x2="11" y1="7" y2="11"></line><path class="ql-even ql-stroke" d="M8.9,4.577a3.476,3.476,0,0,1,.36,4.679A3.476,3.476,0,0,1,4.577,8.9C3.185,7.5,2.035,6.4,4.217,4.217S7.5,3.185,8.9,4.577Z"></path><path class="ql-even ql-stroke" d="M13.423,9.1a3.476,3.476,0,0,0-4.679-.36,3.476,3.476,0,0,0,.36,4.679c1.392,1.392,2.5,2.542,4.679.36S14.815,10.5,13.423,9.1Z"></path></svg>',t.classList.add("ql-disabled"))},methods:{getPhrase(){return this.$refs.linkEditor.getPhrase()},getPhraseHtml(){return this.$refs.linkEditor.getPhraseHtml()},getPhraseWithFormats(){return this.$refs.linkEditor.getPhraseWithFormats()},selectionChange({range:t,source:e}){const s=document.querySelector(".ql-autoLink");s&&(!t||!t.length||e!=="user")?s.classList.add("ql-disabled"):s.classList.remove("ql-disabled")}}},M={};var Nt=u(qt,Ot,Ht,!1,Yt,null,null,null);function Yt(t){for(let e in M)this[e]=M[e]}const Ut=function(){return Nt.exports}();var Ft=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"aioseo-editable-phrase"},[s("div",{staticClass:"domains-report-editable-phrase"},[t.showEditor!==t.rowIndex?s("div",[s("div",{staticClass:"editable-phrase first-phrase",on:{click:function(n){return t.openEditor(t.rowIndex,0)}}},[t.linkSuggestion&&t.showingMorePhrases&&t.suggestionType!=="suggestionsOutbound"?s("input",{attrs:{type:"radio"},domProps:{checked:t.selectedPhrase===0},on:{click:function(n){n.stopPropagation(),t.selectedPhrase=0}}}):t._e(),s("link-assistant-phrase",{class:{hover:t.hoveringOver===0},attrs:{url:t.tooltipUrl(t.row,t.phrases[0]),phrase:t.phrases[0].phrase,phraseHtml:t.phrases[0].phrase_html,anchor:t.phrases[0].anchor},on:{mouseOver:function(n){t.hoveringOver=0},mouseLeave:function(n){t.hoveringOver=-1}},scopedSlots:t._u([{key:"icons",fn:function(){return[s("span",{staticClass:"icons"},[s("svg-pencil"),t.domainsReport?s("svg-trash",{nativeOn:{click:function(n){return function(i){return t.deleteLink(i,t.rowIndex,0)}.apply(null,arguments)}}}):t._e()],1)]},proxy:!0}],null,!1,2783923469)})],1),t.suggestionType!=="suggestionsOutbound"&&1<t.phrases.length&&t.showEditor!==t.rowIndex?s("div",{staticClass:"show-more-phrases"},[s("a",{attrs:{href:"#"},on:{click:function(n){n.preventDefault(),t.$emit("toggleShowMorePhrases",t.rowIndex),t.selectedPhrase=0}}},[s("div",[t._v(t._s(t.viewMorePhrasesLabel))]),s("svg-caret",{class:{rotated:t.showingMorePhrases}})],1)]):t._e(),s("transition-slide",{staticClass:"phrases-list",attrs:{tag:"div",active:t.showingMorePhrases&&t.suggestionType!=="suggestionsOutbound"}},t._l(t.phrases,function(n,i){return s("div",{key:i,staticClass:"editable-phrase-container"},[i?s("div",{staticClass:"editable-phrase selectable-phrase",on:{click:function(o){return t.openEditor(t.rowIndex,i)}}},[t.linkSuggestion&&t.showingMorePhrases?s("input",{attrs:{type:"radio"},domProps:{checked:i===t.selectedPhrase},on:{click:function(o){o.stopPropagation(),t.selectedPhrase=i}}}):t._e(),s("link-assistant-phrase",{class:{hover:i===t.hoveringOver},attrs:{url:t.tooltipUrl(t.row,t.phrases[0]),phrase:n.phrase,phraseHtml:n.phrase_html,anchor:n.anchor},on:{mouseOver:function(o){t.hoveringOver=i},mouseLeave:function(o){t.hoveringOver=-1}},scopedSlots:t._u([{key:"icons",fn:function(){return[s("div",{staticClass:"icons"},[s("svg-pencil"),t.domainsReport?s("svg-trash",{nativeOn:{click:function(o){return function(r){return t.deleteLink(r,t.rowIndex,i)}.apply(null,arguments)}}}):t._e()],1)]},proxy:!0}],null,!0)})],1):t._e()])}),0)],1):t._e(),t.showEditor===t.rowIndex?s("link-assistant-phrase-editor",{ref:"linkEditor",attrs:{value:t.phrases[this.phraseIndex].phrase,phrase:t.phrases[this.phraseIndex].phrase_html,url:t.url,context:t.phraseContext},on:{saveEditor:t.processModifiedPhrase,closeEditor:function(n){t.showEditor=-1,t.hoveringOver=-1}}}):t._e()],1)])},Kt=[];const jt={components:{LinkAssistantPhrase:b,LinkAssistantPhraseEditor:Ut,SvgCaret:N,SvgPencil:st,SvgTrash:m,TransitionSlide:Y},props:{row:{type:Object,required:!0},rowIndex:{type:Number,default:0},activeRow:{type:Number,default:-1},postIndex:{type:Number,required:!1},suggestionType:{type:String,required:!1},selectedPostTitleIndex:{type:Number,required:!1,default(){return 0}},linkSuggestion:{type:Boolean,default(){return!1}},domainsReport:{type:Boolean,default(){return!1}}},data(){return{phraseIndex:-1,showEditor:-1,hoveringOver:-1,selectedPhrase:0}},computed:{...v(["linkAssistant","currentPost"]),phrases(){return this.linkSuggestion?this.row.suggestions.slice(0,10):this.row.links.slice(0,10)},url(){return this.domainsReport?this.phrases[this.phraseIndex].url:this.suggestionType==="suggestionsInbound"?this.row.context.permalink:this.suggestionType==="suggestionsOutbound"?this.row.suggestions[this.selectedPostTitleIndex].context.permalink:""},showingMorePhrases(){return 1<this.phrases.length&&this.activeRow===this.rowIndex},viewMorePhrasesLabel(){const t=1<this.phrases.length?this.phrases.length-1:0;return this.$t.sprintf(this.$t._n("%1$d more phrase","%1$d more phrases",t,this.$td),t)},phraseContext(){let t="",e="";if(this.linkSuggestion){const i=this.row.suggestions[this.phraseIndex];t=i.phrase.trim(),e=i.paragraph.trim()}else{const i=this.row.links[this.phraseIndex];t=i.phrase.trim(),e=i.paragraph.trim()}if(t===e)return"";const s=l(t),n=new RegExp(s,"i");return e.match(n)&&(e=e.replace(n,`<strong>${t}</strong>`)),e}},methods:{tooltipUrl(t,e){return this.domainsReport?e.url:this.suggestionType==="suggestionsInbound"?t.permalink:this.suggestionType==="suggestionsOutbound"&&t.suggestions[this.selectedPostTitleIndex]?t.suggestions[this.selectedPostTitleIndex].context.permalink:""},openEditor(t,e){this.phraseIndex=e,this.showEditor=t},processModifiedPhrase(){this.showEditor=-1,this.hoveringOver=-1;const t=this.$refs.linkEditor.getPhrase(),e=this.$refs.linkEditor.getPhraseHtml(),s=this.$refs.linkEditor.getPhraseWithFormats();let n="";s.ops.forEach(i=>{i.attributes&&i.attributes.link&&(n=n+i.insert)}),n&&this.$emit("saveModifiedPhrase",{phrase:t,phraseHtml:e,anchor:n,postIndex:this.rowIndex,phraseIndex:this.phraseIndex})},deleteLink(t,e,s){t.stopPropagation(),t.preventDefault(),this.$emit("delete",{postIndex:e,linkIndex:s})}}},E={};var zt=u(jt,Ft,Kt,!1,Vt,null,null,null);function Vt(t){for(let e in E)this[e]=E[e]}const z=function(){return zt.exports}();var Zt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"aioseo-link-suggestions-Inbound"},[s("core-wp-table",{key:t.tableKey,class:{"link-assistant-inner-table":!t.postReport},attrs:{columns:t.columns,rows:t.rows,totals:t.post.links.suggestionsInbound.totals,"bulk-options":t.bulkOptions,loading:t.wpTableLoading,showSearch:!1,showPagination:!t.linksReport,showTableFooter:t.postReport,initialPageNumber:t.pageNumber},on:{"process-bulk-action":t.maybeDoBulkAction,paginate:t.processPagination},scopedSlots:t._u([{key:"post_title",fn:function(n){var i=n.row;return[s("strong",[s("a",{staticClass:"edit-link",attrs:{href:i.context.permalink,target:"_blank"}},[t._v(t._s(i.context.postTitle))])]),s("div",{staticClass:"row-actions"},[s("span",{staticClass:"view"},[s("a",{attrs:{href:i.context.permalink,target:"_blank"}},[t._v(t._s(t.viewPost(i.context.postType.singular)))]),t._v(" | ")]),s("span",{staticClass:"edit"},[s("a",{attrs:{href:i.context.editLink,target:"_blank"}},[t._v(t._s(t.editPost(i.context.postType.singular)))]),t._v(" | ")]),s("span",{staticClass:"dismiss"},[s("a",{attrs:{href:"#"},on:{click:function(o){return o.preventDefault(),t.maybeDoBulkAction({action:"dismiss",selectedRows:i})}}},[t._v(t._s(t.strings.dismiss))])])])]}},{key:"phrase",fn:function(n){var i=n.row,o=n.index;return[s("link-assistant-editable-phrase",{ref:"editablePhrase"+o,attrs:{row:i,rowIndex:o,activeRow:t.activeSuggestionRow,postIndex:t.postIndex,suggestionType:t.suggestionType,linkSuggestion:""},on:{hidePhrases:function(r){t.activeSuggestionRow=-1},toggleShowMorePhrases:t.toggleShowMorePhrases,saveModifiedPhrase:t.saveModifiedPhrase}})]}},{key:"add_link",fn:function(n){var i=n.row,o=n.index;return[s("div",{staticClass:"add-link",on:{click:function(r){return r.preventDefault(),t.addLink(i,o)}}},[s("svg-circle-plus"),s("a",[t._v(t._s(t.strings.addLink))])],1)]}}])}),t.postReport?t._e():s("div",{staticClass:"links-bottom"},[s("div",{staticClass:"links-bottom-left"},[t.post.links.suggestionsInbound.totals.total>5&&t.linksReport?s("div",[s("svg-link-external"),s("a",{staticClass:"link-view",attrs:{href:"#"},on:{click:function(n){return n.preventDefault(),t.openPostReport("link-suggestions","suggestions-inbound")}}},[t._v(" "+t._s(t.seeAllSuggestions)+" ")])],1):t._e()]),s("div",{staticClass:"links-bottom-right"},[t.post.links.suggestionsInbound.rows.length?s("a",{staticClass:"link-delete",on:{click:function(n){return n.preventDefault(),t.maybeDoBulkAction({action:"dismiss",selectedRows:"all"})}}},[t._v(" "+t._s(t.strings.dismissAllSuggestions)+" ")]):t._e()])]),s("link-assistant-confirmation-modal",{attrs:{strings:t.modalStrings,showModal:t.showModal,selectedRows:t.selectedRows},on:{closeModal:function(n){t.showModal=!1},doBulkAction:t.doBulkAction}})],1)},Wt=[];const Gt={components:{CoreWpTable:h,LinkAssistantConfirmationModal:_,LinkAssistantEditablePhrase:z,SvgCirclePlus:U,SvgLinkExternal:g},mixins:[w,j],data(){return{suggestionType:"suggestionsInbound",strings:{dismissAllSuggestions:this.$t.sprintf(this.$t.__("Dismiss All %1$s Suggestions",this.$tdPro),this.$t.__("Inbound Internal",this.$tdPro)),noSuggestions:this.$t.sprintf(this.$t.__("You currently don't have any %1$s Suggestions!",this.$tdPro),this.$t.__("Inbound Internal",this.$tdPro))}}},computed:{columns(){return[{slug:"post_title",label:this.$t.__("Post Title",this.$td)},{slug:"spacer",width:"30px"},{slug:"phrase",label:this.$t.__("Phrase",this.$td)},{slug:"add_link",width:"150px"}]},seeAllSuggestions(){return this.$t.sprintf(this.$t.__("See All %1$s %2$s Suggestions",this.$tdPro),this.post.links.suggestionsInbound.totals.total,this.$t.__("Inbound Internal",this.$tdPro))}}},B={};var Jt=u(Gt,Zt,Wt,!1,Qt,null,null,null);function Qt(t){for(let e in B)this[e]=B[e]}const Xt=function(){return Jt.exports}();var ts=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"aioseo-post-title-selector"},[s("div",{staticClass:"post-title first-post-title",on:{mouseover:function(n){t.hoveringOver=0},mouseleave:function(n){t.hoveringOver=-1}}},[t.showingMorePostTitles?s("input",{attrs:{type:"radio"},domProps:{checked:t.selectedPostTitleIndex===0},on:{click:function(n){return n.stopPropagation(),t.selectDifferentPostTitle(0)}}}):t._e(),s("span",{staticClass:"post-title-text"},[t._v(t._s(t.postTitles[0]))]),s("div",{staticClass:"row-actions",class:{hover:t.hoveringOver===0}},[s("span",{staticClass:"view"},[s("a",{attrs:{href:t.row.suggestions[0].context.permalink,target:"_blank"}},[t._v(t._s(t.viewPost(t.row.suggestions[0].context.postType.singular)))]),t._v(" | ")]),s("span",{staticClass:"edit"},[s("a",{attrs:{href:t.row.suggestions[0].context.editLink,target:"_blank"}},[t._v(t._s(t.editPost(t.row.suggestions[0].context.postType.singular)))])])])]),1<t.postTitles.length?s("div",{staticClass:"show-more-post-titles"},[s("a",{attrs:{href:"#"},on:{click:function(n){n.preventDefault(),t.$emit("toggleShowMorePhrases",t.rowIndex),t.selectDifferentPostTitle(0)}}},[s("div",[t._v(t._s(t.viewMorePostTitlesLabel))]),s("svg-caret",{class:{rotated:t.showingMorePostTitles}})],1)]):t._e(),s("transition-slide",{staticClass:"post-titles-list",attrs:{tag:"div",active:t.showingMorePostTitles}},t._l(t.postTitles,function(n,i){return s("div",{key:i,staticClass:"post-title post-title-container"},[i?s("div",{staticClass:"selectable-post-title",on:{mouseover:function(o){t.hoveringOver=i},mouseleave:function(o){t.hoveringOver=-1}}},[t.showingMorePostTitles?s("input",{attrs:{type:"radio"},domProps:{checked:i===t.selectedPostTitleIndex},on:{click:function(o){return o.stopPropagation(),t.selectDifferentPostTitle(i)}}}):t._e(),s("span",{staticClass:"post-title-text"},[t._v(t._s(t.postTitles[i]))]),s("div",{staticClass:"row-actions",class:{hover:i===t.hoveringOver}},[s("span",{staticClass:"view"},[s("a",{attrs:{href:t.row.suggestions[i].context.permalink,target:"_blank"}},[t._v(t._s(t.viewPost(t.row.suggestions[i].context.postType.singular)))]),t._v(" | ")]),s("span",{staticClass:"edit"},[s("a",{attrs:{href:t.row.suggestions[i].context.editLink,target:"_blank"}},[t._v(t._s(t.editPost(t.row.suggestions[i].context.postType.singular)))])])])]):t._e()])}),0)],1)},ss=[];const es={components:{SvgCaret:N,TransitionSlide:Y},mixins:[w],props:{row:{type:Object,required:!0},rowIndex:{type:Number,default:0},activeRow:{type:Number,default:-1},postIndex:{type:Number,required:!1},suggestionType:{type:String,required:!1}},data(){return{selectedPostTitleIndex:-1,hoveringOver:-1}},computed:{...v(["linkAssistant","currentPost"]),postTitles(){const t=[];return this.row.suggestions.forEach(e=>{t.includes[e.context.postTitle]||t.push(e.context.postTitle)}),t.slice(0,10)},showingMorePostTitles(){return 1<this.postTitles.length&&this.activeRow===this.rowIndex},viewMorePostTitlesLabel(){const t=1<this.postTitles.length?this.postTitles.length-1:0;return this.$t.sprintf(this.$t._n("%1$d more post","%1$d more posts",t,this.$td),t)}},methods:{selectDifferentPostTitle(t){this.selectedPostTitleIndex!==t&&(this.selectedPostTitleIndex=t,this.$emit("postTitleIndexChanged",t))}}},D={};var ns=u(es,ts,ss,!1,is,null,null,null);function is(t){for(let e in D)this[e]=D[e]}const os=function(){return ns.exports}();var rs=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"aioseo-link-suggestions-outbound"},[s("core-wp-table",{key:t.tableKey,class:{"link-assistant-inner-table":!t.postReport},attrs:{columns:t.columns,rows:t.rows,totals:t.post.links.suggestionsOutbound.totals,"bulk-options":t.bulkOptions,loading:t.wpTableLoading,showSearch:!1,showPagination:!t.linksReport,showTableFooter:t.postReport,initialPageNumber:t.pageNumber},on:{"process-bulk-action":t.maybeDoBulkAction,paginate:t.processPagination},scopedSlots:t._u([{key:"post_title",fn:function(n){var i=n.row,o=n.index;return[s("link-assistant-post-title-selector",{ref:"postTitleSelector"+o,attrs:{row:i,rowIndex:o,activeRow:t.activeSuggestionRow,postIndex:t.postIndex,suggestionType:t.suggestionType,linkSuggestion:""},on:{hidePhrases:function(r){t.activeSuggestionRow=-1},toggleShowMorePhrases:t.toggleShowMorePhrases,saveModifiedPhrase:t.saveModifiedPhrase,postTitleIndexChanged:function(r){return t.selectedPostTitleIndex=r}}})]}},{key:"phrase",fn:function(n){var i=n.row,o=n.index;return[s("link-assistant-editable-phrase",{attrs:{row:i,rowIndex:o,activeRow:t.activeSuggestionRow,postIndex:t.postIndex,suggestionType:t.suggestionType,selectedPostTitleIndex:t.selectedPostTitleIndex,linkSuggestion:""},on:{hidePhrases:function(r){t.activeSuggestionRow=-1},saveModifiedPhrase:t.saveModifiedPhrase}}),s("div",{staticClass:"row-actions"},[s("span",{staticClass:"dismiss"},[s("a",{attrs:{href:"#"},on:{click:function(r){return r.preventDefault(),t.maybeDoBulkAction({action:"dismiss",selectedRows:i})}}},[t._v(t._s(t.strings.dismiss))])])])]}},{key:"add_link",fn:function(n){var i=n.row,o=n.index;return[s("div",{staticClass:"add-link",on:{click:function(r){return r.preventDefault(),t.addLink(i,o)}}},[s("svg-circle-plus"),s("a",[t._v(t._s(t.strings.addLink))])],1)]}}])}),t.postReport?t._e():s("div",{staticClass:"links-bottom"},[s("div",{staticClass:"links-bottom-left"},[t.post.links.suggestionsOutbound.totals.total>5&&t.linksReport?s("div",[s("svg-link-external"),s("a",{staticClass:"link-view",attrs:{href:"#"},on:{click:function(n){return n.preventDefault(),t.openPostReport("link-suggestions","suggestions-outbound")}}},[t._v(" "+t._s(t.seeAllSuggestions)+" ")])],1):t._e()]),s("div",{staticClass:"links-bottom-right"},[t.filteredSuggestionsOutbound.length?s("a",{staticClass:"link-delete",on:{click:function(n){return n.preventDefault(),t.maybeDoBulkAction({action:"dismiss",selectedRows:"all"})}}},[t._v(" "+t._s(t.strings.dismissAllSuggestions)+" ")]):t._e()])]),s("link-assistant-confirmation-modal",{attrs:{strings:t.modalStrings,showModal:t.showModal,selectedRows:t.selectedRows},on:{closeModal:function(n){t.showModal=!1},doBulkAction:t.doBulkAction}})],1)},as=[];const ls={components:{CoreWpTable:h,LinkAssistantConfirmationModal:_,LinkAssistantEditablePhrase:z,LinkAssistantPostTitleSelector:os,SvgCirclePlus:U,SvgLinkExternal:g},mixins:[j],data(){return{suggestionType:"suggestionsOutbound",selectedPostTitleIndex:0,strings:{dismissAllSuggestions:this.$t.sprintf(this.$t.__("Dismiss All %1$s Suggestions",this.$tdPro),this.$t.__("Outbound Internal",this.$tdPro)),noSuggestions:this.$t.sprintf(this.$t.__("You currently don't have any %1$s Suggestions!",this.$tdPro),this.$t.__("Outbound Internal",this.$tdPro))}}},computed:{columns(){return[{slug:"phrase",label:this.$t.__("Phrase",this.$td)},{slug:"spacer",width:"30px"},{slug:"post_title",label:this.$t.__("Post Title",this.$td)},{slug:"add_link",width:"150px"}]},seeAllSuggestions(){return this.$t.sprintf(this.$t.__("See All %1$s %2$s Suggestions",this.$tdPro),this.post.links.suggestionsOutbound.totals.total,this.$t.__("Outbound Internal",this.$tdPro))}}},O={};var us=u(ls,rs,as,!1,cs,null,null,null);function cs(t){for(let e in O)this[e]=O[e]}const ds=function(){return us.exports}();var ps=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"aioseo-link-suggestions"},[t.internalOptions.internal.dismissedAlerts.suggestions?t._e():s("core-alert",{staticClass:"description",attrs:{type:"blue","show-close":""},on:{"close-alert":t.dismissAlert}},[s("span",{domProps:{innerHTML:t._s(t.strings.description)}})]),s("core-main-tabs",{key:t.tabsKey,attrs:{internal:"",tabs:t.tabs,active:t.activeTab,showSaveButton:!1},on:{changed:t.processChangeTab},scopedSlots:t._u([{key:"md-tab-icon",fn:function(n){var i=n.tab;return[s(i.icon,{tag:"component",class:[{warning:i.data.warning}]})]}}])}),s("div",{staticClass:"link-suggestions-container"},[s("keep-alive",[t.activeTab==="suggestions-outbound"?s("outbound",{attrs:{post:t.post,postIndex:t.postIndex,postId:t.postId,filteredSuggestionsOutbound:t.filteredSuggestionsOutbound,linksReport:t.linksReport,postReport:t.postReport,metabox:t.metabox},on:{linksUpdated:function(n){t.tabsKey++,t.$emit("linksUpdated")}}}):t._e()],1),s("keep-alive",[t.activeTab==="suggestions-inbound"?s("inbound",{attrs:{post:t.post,postIndex:t.postIndex,postId:t.postId,linksReport:t.linksReport,postReport:t.postReport,metabox:t.metabox},on:{linksUpdated:function(n){t.tabsKey++,t.$emit("linksUpdated")}}}):t._e()],1)],1)],1)},hs=[];const gs={components:{CoreAlert:G,CoreMainTabs:J,Inbound:Xt,Outbound:ds,SvgLinkInternalInbound:V,SvgLinkInternalOutbound:Z},mixins:[$],props:{filteredSuggestionsOutbound:{type:Array,required:!0},initialTab:{type:String,required:!1},showAlert:{type:Boolean,default(){return!1}}},data(){return{tabsKey:0,activeTab:"suggestions-inbound",strings:{description:this.$t.sprintf(this.$t.__("Below you can add inbound and outbound internal links based on %1$s's smart suggestions. These suggestions are generated in the background, which requires some time to complete. %2$s",this.$tdPro),"AIOSEO",this.$links.getDocLink(this.$constants.GLOBAL_STRINGS.learnMore,"linkAssistant",!0))}}},computed:{...v("linkAssistant",["internalOptions"]),...W("linkAssistant",["getLinksReportCounts"]),tabs(){return[{slug:"suggestions-inbound",icon:"svg-link-internal-inbound",name:this.$t.sprintf("%1$s %2$s",this.metabox?this.post.links.suggestionsInbound.totals.total:this.getLinksReportCounts[this.postIndex].suggestionsInbound,this.$t.__("Inbound Internal Suggestions",this.$tdPro))},{slug:"suggestions-outbound",icon:"svg-link-internal-outbound",name:this.$t.sprintf("%1$s %2$s",this.metabox?this.filteredSuggestionsOutbound.length:this.getLinksReportCounts[this.postIndex].suggestionsOutbound,this.$t.__("Outbound Internal Suggestions",this.$tdPro))}]}},methods:{processChangeTab(t){this.activeTab=t,this.$emit("suggestionsTabChanged",t)},dismissAlert(){this.internalOptions.internal.dismissedAlerts.suggestions=!0,this.$http.get(this.$links.restUrl("link-assistant/data/dismiss-alert")).catch(t=>console.log("Could not dismiss suggestions alert:",t))}},beforeMount(){this.initialTab&&(this.activeTab=this.initialTab)}},H={};var _s=u(gs,ps,hs,!1,fs,null,null,null);function fs(t){for(let e in H)this[e]=H[e]}const Os=function(){return _s.exports}();export{Ms as L,w as P,K as S,Es as a,Bs as b,Ds as c,Os as d,Ls as e,_ as f,z as g};
