import{g as x,i as R,a as m,m as N,e as W}from"./index.cf8251b7.js";import{C as Z,W as h}from"./WpTable.9fcf1d36.js";import{n as u}from"./vueComponentNormalizer.58b0a173.js";import{C as v}from"./Tooltip.060399ab.js";import{C as g}from"./Table.37b776fb.js";import{a as _,b as G,c as J}from"./Affiliate.4f7dfe83.js";import{S as Q,i as $,c as Y,h as X,C as tt}from"./index.8e492c68.js";import{C as st}from"./Tabs.d85e9532.js";import{B as et}from"./Editor.0d4dfada.js";import{T as F}from"./Slide.8aaa5049.js";import{S as U}from"./Plus.6ec3819c.js";const l=t=>t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),Is={methods:{filteredSuggestionsOutbound(t){const e=t.links.suggestionsOutbound.rows,s=[];return e.forEach(i=>{this.editorIsSuggestionAlreadyAdded(i)||s.push(i)}),s},editorIsSuggestionAlreadyAdded(t){return x()?this.blockEditorIsSuggestionAlreadyAdded(t):R()?this.classicEditorIsSuggestionAlreadyAdded(t):!1},blockEditorIsSuggestionAlreadyAdded(t){const e=window.wp.data.select("core/block-editor").getBlocks();return e?this.doesBlockHaveLink(e,t):!1},doesBlockHaveLink(t,e){let s=!1;return t.forEach(i=>{s||!i.attributes||e.suggestions.forEach(n=>{const o=l(n.context.permalink.trim()),r=new RegExp(`(<a href="${o}"[^<>]*>)(.*)(</a[^<>]*>)`,"i");if(i.attributes.content&&i.attributes.content.search(r)!==-1){s=!0;return}if(!i.innerBlocks)return;this.doesBlockHaveLink(i.innerBlocks,e)&&(s=!0)})}),s},classicEditorIsSuggestionAlreadyAdded(t){let e="",s=null,i=null;if(document.querySelector("#wp-content-wrap.tmce-active")?(s=window.tinyMCE.get("content"),e=s.getContent({format:"raw"})):(i=document.querySelector("textarea#content"),e=i?i.value:""),!e)return!1;let n=!1;return t.suggestions.forEach(o=>{const r=l(o.context.permalink.trim()),a=new RegExp(`(<a href="${r}"[^<>]*>)(.*)(</a[^<>]*>)`,"i");e.search(a)!==-1&&(n=!0)}),n}}},j={methods:{findTargetBlock(t,e){const s=l(e);let i=null;return t.forEach(n=>{if(i||!n.attributes)return;if(n.attributes.content&&n.attributes.content.search(s)!==-1){i=n.clientId;return}if(!n.innerBlocks)return;const o=this.findTargetBlock(n.innerBlocks,e);o&&(i=o)}),i}}},b={mixins:[j],props:{post:{type:Object,required:!0},postIndex:{type:Number,required:!1},postId:{type:Number,required:!1},linksReport:{type:Boolean,default(){return!1}},postReport:{type:Boolean,default(){return!1}},metabox:{type:Boolean,default(){return!1}}},beforeMount(){this.$bus.$on("updatingLinks",t=>{this.wpTableLoading=t}),this.pageNumber=this.linkType?this.linkAssistant.postReport[this.linkType].totals.page:1},data(){return{changeItemsPerPageSlug:"linkAssistantPostsReport",action:"",showModal:!1,selectedRows:[],bulkOptions:[{label:this.$t.__("Delete",this.$td),value:"delete"}],strings:{frontPage:this.$t.__("Front Page",this.$tdPro),deleteLink:this.$t.__("Delete Link",this.$tdPro)},modalStrings:{areYouSureSingle:this.$t.__("Are you sure you want to delete this link?",this.$tdPro),areYouSureMultiple:this.$t.__("Are you sure you want to delete these links?",this.$tdPro),areYouSureAll:this.$t.__("Are you sure you want to delete all links?",this.$tdPro),actionCannotBeUndone:this.$t.__("This action cannot be undone.",this.$tdPro),yesSingle:this.$t.__("Yes, I want to delete this link",this.$tdPro),yesMultiple:this.$t.__("Yes, I want to delete these links",this.$tdPro),yesAll:this.$t.__("Yes, I want to delete all links",this.$tdPro),noChangedMind:this.$t.__("No, I changed my mind",this.$tdPro)}}},computed:{...m(["linkAssistant","currentPost"]),rows(){if(!this.metabox)return this.post.links[this.linkType].rows;const t=this.pageNumber===1?0:(this.pageNumber-1)*10;return this.post.links[this.linkType].rows.slice(t,t+10)}},methods:{...N("linkAssistant",["linkDelete","linksBulk","fetchPostReport","fetchLinksReportInner","postSettingsUpdate"]),fetchData(t){this.$bus.$emit("updatingLinks",!0);const e={...t,additionalFilters:{postId:this.post.ID,postIndex:this.postIndex,type:this.linkType}},s=this.postReport?"fetchPostReport":"fetchLinksReportInner";return this[s](e).finally(()=>{this.$bus.$emit("updatingLinks",!1)})},openPostReport(t){window.location.href=`#/post-report?postId=${this.postId}&postIndex=${this.postIndex}&initialTab=${t}`},maybeDoBulkAction({action:t,selectedRows:e}){e===!1||!t||(this.action=t,this.selectedRows=e,this.showModal=!0)},doBulkAction(){if(this.showModal=!1,!(this.selectedRows===!1||typeof this.selectedRows>"u")){if(typeof this.selectedRows=="number"){this.doDeleteLink(this.selectedRows);return}if(this.metabox&&this.linkType!=="inboundInternal"){this.idsToIndexes(this.selectedRows).forEach(e=>{this.editorRemoveLink(e)});return}this.$bus.$emit("updatingLinks",!0),this.linksBulk({postIndex:this.postIndex,postId:this.post.ID||this.currentPost.id,action:this.action,linkType:this.linkType,linkIds:this.selectedRows,linksReport:this.linksReport,postReport:this.postReport}).finally(()=>{this.$bus.$emit("updatingLinks",!1),this.$emit("linksUpdated"),this.refreshTable()})}},doDeleteLink(t){const e=this.post.links[this.linkType].rows[t].id;if(!!e){if(this.metabox&&this.linkType!=="inboundInternal"){this.editorRemoveLink(t);return}this.$bus.$emit("updatingLinks",!0),this.linkDelete({postIndex:this.postIndex,postId:this.post.ID||this.currentPost.id,linkId:e,linksReport:this.linksReport,postReport:this.postReport}).finally(()=>{this.$bus.$emit("updatingLinks",!1),this.$emit("linksUpdated"),this.refreshTable()})}},editorRemoveLink(t){x()&&(this.$bus.$emit("updatingLinks",!1),this.blockEditorRemoveLink(t),this.$bus.$emit("updatingLinks",!1)),R()&&this.classicEditorRemoveLink(t)},blockEditorRemoveLink(t){const e=this.currentPost.linkAssistant.links[this.linkType].rows[t];if(!e)return;this.$bus.$emit("updatingLinks",!0);const s=l(e.anchor.trim()),i=e.phrase_html.trim(),n=l(i),o=window.wp.data.select("core/block-editor").getBlocks(),r=this.findTargetBlock(o,i);if(!r){this.$bus.$emit("updatingLinks",!1);return}const a=window.wp.data.select("core/block-editor").getBlock(r);if(!a){this.$bus.$emit("updatingLinks",!1);return}let c=new RegExp(`(<t?a[^<>]*>)(.*)?(${s})(.*)?(</t?a[^<>]*>)`,"i");const d=i.replace(c,"$2$3$4");c=new RegExp(`${n}`,"i"),window.wp.data.dispatch("core/block-editor").updateBlockAttributes(r,{content:a.attributes.content.replace(c,d)}).then(()=>{this.$delete(this.post.links[this.linkType].rows,t)}).catch(k=>{console.error(`Couldn	 delete link with type "${this.linkType}" and index ${t}:`,k)}).finally(()=>{this.$bus.$emit("updatingLinks",!1),this.$emit("linksUpdated")})},classicEditorRemoveLink(t){const e=this.currentPost.linkAssistant.links[this.linkType].rows[t];if(!e||!window.tinyMCE)return;this.$bus.$emit("updatingLinks",!0);let s="",i=null,n=null;if(document.querySelector("#wp-content-wrap.tmce-active")?(i=window.tinyMCE.get("content"),s=i.getContent({format:"raw"})):(n=document.querySelector("textarea#content"),s=n?n.value:""),!s){this.$bus.$emit("updatingLinks",!1);return}let o=e.phrase_html.trim();i||(o=o.replace(/(\sdata-mce-href=".*")/gi,""));const r=l(e.anchor.trim());let a=new RegExp(`(<t?a[^<>]*>)(.*)?(${r})(.*)?(</t?a[^<>]*>)`,"i");const c=o.replace(a,"$2$3$4"),d=l(o);a=new RegExp(`${d}`,"i"),s=s.replace(a,c),i?i.setContent(s):n.value=s,this.$delete(this.post.links[this.linkType].rows,t),this.postSettingsUpdate({postContent:s}).finally(()=>{this.$bus.$emit("updatingLinks",!1),this.$emit("linksUpdated")})},idsToIndexes(t){let e,s=[];return Array.isArray(t)&&(e=t.map(Number)),e&&this.post.links[this.linkType].rows.forEach((i,n)=>{e.includes(i.id)&&s.push(n)}),t==="all"&&(s=this.post.links[this.linkType].rows.map((i,n)=>n)),s.sort(function(i,n){return n-i})}}};var it=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("core-modal",{staticClass:"aioseo-confirmation-modal",attrs:{"no-header":""},scopedSlots:t._u([{key:"body",fn:function(){return[s("div",{staticClass:"aioseo-modal-body"},[s("button",{staticClass:"close",on:{click:function(i){return i.stopPropagation(),t.$emit("closeModal",!0)}}},[s("svg-close",{on:{click:function(i){return t.$emit("closeModal",!0)}}})],1),s("h3",[t._v(t._s(t.areYouSure))]),s("div",{staticClass:"reset-description",domProps:{innerHTML:t._s(t.strings.actionCannotBeUndone)}}),s("base-button",{attrs:{type:"blue",size:"medium"},on:{click:function(i){return t.$emit("doBulkAction",i)}}},[t._v(" "+t._s(t.confirmation)+" ")]),s("base-button",{attrs:{type:"gray",size:"medium"},on:{click:function(i){return t.$emit("closeModal",!0)}}},[t._v(" "+t._s(t.strings.noChangedMind)+" ")])],1)]},proxy:!0}])})},nt=[];const ot={components:{CoreModal:Z,SvgClose:Q},props:{selectedRows:{required:!0},strings:{type:Object,required:!0}},computed:{areYouSure(){return this.selectedRows==="all"?this.strings.areYouSureAll:Array.isArray(this.selectedRows)&&1<this.selectedRows.length?this.strings.areYouSureMultiple:this.strings.areYouSureSingle},confirmation(){return this.selectedRows==="all"?this.strings.yesAll:Array.isArray(this.selectedRows)&&1<this.selectedRows.length?this.strings.yesMultiple:this.strings.yesSingle}}},S={};var rt=u(ot,it,nt,!1,at,null,null,null);function at(t){for(let e in S)this[e]=S[e]}const f=function(){return rt.exports}();var lt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"aioseo-link-assistant-phrase",on:{mouseover:function(i){return t.$emit("mouseOver")},mouseleave:function(i){return t.$emit("mouseLeave")}}},[s("span",{staticClass:"phrase"},[s("span",{staticClass:"first"},[t._v(t._s(t.firstPart))]),t.tooltip?s("core-tooltip",{attrs:{type:"action"},scopedSlots:t._u([{key:"tooltip",fn:function(){return[s("a",{staticClass:"tooltip-url",attrs:{href:t.url,target:"_blank"}},[t._v(t._s(t.url))])]},proxy:!0}],null,!1,3985851943)},[s("span",{staticClass:"anchor",on:{click:t.maybeOpenLink}},[t._v(t._s(t.linkAnchor))])]):t._e(),t.tooltip?t._e():s("div",[s("span",{staticClass:"anchor"},[t._v(t._s(t.linkAnchor))])]),s("span",{staticClass:"last"},[t._v(t._s(t.lastPart))])],1),t._t("icons")],2)},ut=[];const ct={components:{CoreTooltip:v},props:{phrase:{type:String,required:!0},phraseHtml:{type:String,required:!0},anchor:{type:String,required:!0},url:{type:String,required:!0},tooltip:{type:Boolean,required:!1,default:!0},clickableAnchor:{type:Boolean,default(){return!1}}},computed:{partPattern(){const t=l(this.anchor);return new RegExp(`(.*)(<t?a[^>]*>.*${t}.*</t?a>)(.*)`,"i")},firstPart(){return this.stripTags(this.getPart(1))},linkAnchor(){return this.stripTags(this.getPart(2))},lastPart(){return this.stripTags(this.getPart(3))}},methods:{getPart(t){const e=this.phraseHtml.match(this.partPattern);return e?e[t]:""},stripTags(t){return t.replace(/(<([^>]+)>)/gi,"")},maybeOpenLink(){this.clickableAnchor&&window.open(this.url,"_blank").focus()}}},A={};var dt=u(ct,lt,ut,!1,pt,null,null,null);function pt(t){for(let e in A)this[e]=A[e]}const w=function(){return dt.exports}();var ht=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("core-wp-table",{key:t.wpTableKey,class:{"link-assistant-inner-table":!t.postReport},attrs:{"bulk-options":t.bulkOptions,columns:t.columns,id:t.tableId,"initial-items-per-page":t.$aioseo.settings.tablePagination.linkAssistantPostsReport,"initial-page-number":t.pageNumber,loading:t.wpTableLoading,rows:t.rows,"show-pagination":!t.linksReport,"show-search":!1,"show-table-footer":t.postReport,totals:t.post.links.affiliate.totals,"show-items-per-page":""},on:{paginate:t.processPagination,"process-bulk-action":t.maybeDoBulkAction,"process-change-items-per-page":t.processChangeItemsPerPage},scopedSlots:t._u([{key:"phrase",fn:function(i){var n=i.row;return[s("link-assistant-phrase",{attrs:{phrase:n.phrase,phraseHtml:n.phrase_html,anchor:n.anchor,url:n.url,clickableAnchor:!0}})]}},{key:"created",fn:function(i){var n=i.column;return[t._v(" "+t._s(t.$moment.utc(n).tz(t.$moment.tz.guess()).format("MMMM D, YYYY"))+" ")]}},{key:"delete",fn:function(i){var n=i.index;return[s("core-tooltip",{attrs:{type:"action"},scopedSlots:t._u([{key:"tooltip",fn:function(){return[t._v(" "+t._s(t.strings.deleteLink)+" ")]},proxy:!0}],null,!0)},[s("svg-trash",{nativeOn:{click:function(o){return t.maybeDoBulkAction({action:"delete",selectedRows:n})}}})],1)]}}])}),t.postReport?t._e():s("div",{staticClass:"links-bottom"},[s("div",{staticClass:"links-bottom-left"},[t.post.links.affiliate.totals.total>5&&t.postReport?s("div",[s("svg-link-external"),s("a",{staticClass:"link-view",attrs:{href:"#"},on:{click:function(i){return i.preventDefault(),t.openPostReport("affiliate")}}},[t._v(" "+t._s(t.seeAllLinks)+" ")])],1):t._e()]),s("div",{staticClass:"links-bottom-right"},[t.post.links.affiliate.rows.length?s("a",{staticClass:"link-delete",on:{click:function(i){return i.preventDefault(),t.maybeDoBulkAction({action:"delete",selectedRows:"all"})}}},[t._v(" "+t._s(t.strings.deleteAllLinks)+" ")]):t._e()])]),t.showModal?s("link-assistant-confirmation-modal",{attrs:{selectedRows:t.selectedRows,strings:t.modalStrings},on:{doBulkAction:t.doBulkAction,closeModal:function(i){t.showModal=!1}}}):t._e()],1)},gt=[];const _t={components:{CoreTooltip:v,CoreWpTable:g,LinkAssistantConfirmationModal:f,LinkAssistantPhrase:w,SvgLinkExternal:_,SvgTrash:$},mixins:[b,h],data(){return{tableId:"aioseo-post-report-affiliate",linkType:"affiliate",strings:{deleteAllLinks:this.$t.sprintf(this.$t.__("Delete All %1$s Links",this.$td),this.$t.__("Affiliate",this.$tdPro))}}},computed:{columns(){return[{slug:"phrase",label:this.$t.__("Phrase",this.$td)},{slug:"delete",width:"50px"}]},seeAllLinks(){return this.$t.sprintf(this.$t.__("See All %1$s %2$s Links",this.$td),this.post.links.affiliate.totals.total,this.$t.__("Affiliate",this.$tdPro))}},methods:{processPagination(t){this.pageNumber=t,!this.metabox&&(this.wpTableLoading=!0,this.processFetchTableData().then(()=>this.wpTableLoading=!1))}}},I={};var ft=u(_t,ht,gt,!1,kt,null,null,null);function kt(t){for(let e in I)this[e]=I[e]}const Ts=function(){return ft.exports}();var mt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("core-wp-table",{key:t.wpTableKey,class:{"link-assistant-inner-table":!t.postReport},attrs:{"bulk-options":t.bulkOptions,columns:t.columns,id:t.tableId,"initial-items-per-page":t.$aioseo.settings.tablePagination.linkAssistantPostsReport,"initial-page-number":t.pageNumber,loading:t.wpTableLoading,rows:t.rows,"show-pagination":!t.linksReport,"show-search":!1,"show-table-footer":t.postReport,totals:t.post.links.external.totals,"show-items-per-page":""},on:{paginate:t.processPagination,"process-bulk-action":t.maybeDoBulkAction,"process-change-items-per-page":t.processChangeItemsPerPage},scopedSlots:t._u([{key:"phrase",fn:function(i){var n=i.row;return[s("link-assistant-phrase",{attrs:{phrase:n.phrase,phraseHtml:n.phrase_html,anchor:n.anchor,url:n.url,clickableAnchor:!0}})]}},{key:"created",fn:function(i){var n=i.column;return[t._v(" "+t._s(t.$moment.utc(n).tz(t.$moment.tz.guess()).format("MMMM D, YYYY"))+" ")]}},{key:"delete",fn:function(i){var n=i.index;return[s("core-tooltip",{attrs:{type:"action"},scopedSlots:t._u([{key:"tooltip",fn:function(){return[t._v(" "+t._s(t.strings.deleteLink)+" ")]},proxy:!0}],null,!0)},[s("svg-trash",{nativeOn:{click:function(o){return t.maybeDoBulkAction({action:"delete",selectedRows:n})}}})],1)]}}])}),t.postReport?t._e():s("div",{staticClass:"links-bottom"},[s("div",{staticClass:"links-bottom-left"},[t.post.links.external.totals.total>5&&t.linksReport?s("div",[s("svg-link-external"),s("a",{staticClass:"link-view",attrs:{href:"#"},on:{click:function(i){return i.preventDefault(),t.openPostReport("external")}}},[t._v(" "+t._s(t.seeAllLinks)+" ")])],1):t._e()]),s("div",{staticClass:"links-bottom-right"},[t.post.links.external.rows.length?s("a",{staticClass:"link-delete",on:{click:function(i){return i.preventDefault(),t.maybeDoBulkAction({action:"delete",selectedRows:"all"})}}},[t._v(" "+t._s(t.strings.deleteAllLinks)+" ")]):t._e()])]),t.showModal?s("link-assistant-confirmation-modal",{attrs:{selectedRows:t.selectedRows,strings:t.modalStrings},on:{doBulkAction:t.doBulkAction,closeModal:function(i){t.showModal=!1}}}):t._e()],1)},vt=[];const $t={components:{CoreTooltip:v,CoreWpTable:g,LinkAssistantConfirmationModal:f,LinkAssistantPhrase:w,SvgLinkExternal:_,SvgTrash:$},mixins:[b,h],data(){return{tableId:"aioseo-post-report-external",linkType:"external",strings:{deleteAllLinks:this.$t.sprintf(this.$t.__("Delete All %1$s Links",this.$td),this.$t.__("External",this.$tdPro))}}},computed:{columns(){return[{slug:"phrase",label:this.$t.__("Phrase",this.$td)},{slug:"delete",width:"50px"}]},seeAllLinks(){return this.$t.sprintf(this.$t.__("See All %1$s %2$s Links",this.$td),this.post.links.external.totals.total,this.$t.__("External",this.$tdPro))}},methods:{processPagination(t){this.pageNumber=t,!this.metabox&&(this.wpTableLoading=!0,this.processFetchTableData().then(()=>this.wpTableLoading=!1))}}},T={};var bt=u($t,mt,vt,!1,wt,null,null,null);function wt(t){for(let e in T)this[e]=T[e]}const Cs=function(){return bt.exports}(),y={methods:{viewPost(t){return this.$t.sprintf(this.$t.__("View %1$s",this.$td),t)},editPost(t){return this.$t.sprintf(this.$t.__("Edit %1$s",this.$td),t)}}};var yt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("svg",{staticClass:"aioseo-link-suggestion",attrs:{viewBox:"0 0 17 10",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[s("path",{attrs:{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M7.66699 7.43742H4.33366C2.95866 7.43742 1.83366 6.31242 1.83366 4.93742C1.83366 3.56242 2.95866 2.43742 4.33366 2.43742H7.66699V0.770752H4.33366C2.03366 0.770752 0.166992 2.63742 0.166992 4.93742C0.166992 7.23742 2.03366 9.10408 4.33366 9.10408H7.66699V7.43742ZM12.667 0.770752H9.33366V2.43742H12.667C14.042 2.43742 15.167 3.56242 15.167 4.93742C15.167 6.31242 14.042 7.43742 12.667 7.43742H9.33366V9.10408H12.667C14.967 9.10408 16.8337 7.23742 16.8337 4.93742C16.8337 2.63742 14.967 0.770752 12.667 0.770752ZM11.8337 4.10409H5.16699V5.77075H11.8337V4.10409Z",fill:"currentColor"}})])},Pt=[];const xt={},C={};var Rt=u(xt,yt,Pt,!1,St,null,null,null);function St(t){for(let e in C)this[e]=C[e]}const z=function(){return Rt.exports}();var At=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("core-wp-table",{key:t.wpTableKey,class:{"link-assistant-inner-table":!t.postReport},attrs:{"bulk-options":t.bulkOptions,columns:t.columns,id:t.tableId,"initial-items-per-page":t.$aioseo.settings.tablePagination.linkAssistantPostsReport,"initial-page-number":t.pageNumber,loading:t.wpTableLoading,rows:t.rows,"show-pagination":!t.linksReport,"show-search":!1,"show-table-footer":t.postReport,totals:t.post.links.inboundInternal.totals,"show-items-per-page":""},on:{paginate:t.processPagination,"process-bulk-action":t.maybeDoBulkAction,"process-change-items-per-page":t.processChangeItemsPerPage},scopedSlots:t._u([{key:"post_title",fn:function(i){var n=i.row;return[s("span",[t._v(" "+t._s(n.context.postTitle)+" "),n.context.permalink.replace(/\/$/,"")===t.$aioseo.urls.home?s("span",[t._v("("+t._s(t.strings.frontPage)+")")]):t._e()]),n.context?s("div",{staticClass:"row-actions"},[s("span",{staticClass:"view"},[s("a",{attrs:{href:n.context.permalink,target:"_blank"}},[t._v(t._s(t.maybeViewPost(n)))]),t._v(" | ")]),s("span",{staticClass:"edit"},[s("a",{attrs:{href:n.context.editLink,target:"_blank"}},[t._v(t._s(t.maybeEditPost(n)))])])]):t._e()]}},{key:"phrase",fn:function(i){var n=i.row;return[s("link-assistant-phrase",{attrs:{phrase:n.phrase,phraseHtml:n.phrase_html||"",anchor:n.anchor,url:n.url,clickableAnchor:!0}})]}},{key:"delete",fn:function(i){var n=i.index;return[s("core-tooltip",{attrs:{type:"action"},scopedSlots:t._u([{key:"tooltip",fn:function(){return[t._v(" "+t._s(t.strings.deleteLink)+" ")]},proxy:!0}],null,!0)},[s("svg-trash",{nativeOn:{click:function(o){return t.maybeDoBulkAction({action:"delete",selectedRows:n})}}})],1)]}}])}),t.postReport?t._e():s("div",{staticClass:"links-bottom"},[s("div",{staticClass:"links-bottom-left"},[t.post.links.inboundInternal.rows.length?s("base-button",{attrs:{type:"blue",tag:"button"},nativeOn:{click:function(i){return t.$emit("openSuggestions")}}},[s("svg-link-suggestion"),t._v(" "+t._s(t.strings.outboundSuggestions)+" ")],1):t._e(),t.post.links.inboundInternal.totals.total>5&&t.linksReport?s("div",[s("svg-link-external"),s("a",{staticClass:"link-view",attrs:{href:"#"},on:{click:function(i){return i.preventDefault(),t.openPostReport("inbound-internal")}}},[t._v(" "+t._s(t.seeAllLinks)+" ")])],1):t._e()],1),s("div",{staticClass:"links-bottom-right"},[t.post.links.inboundInternal.rows.length?s("a",{staticClass:"link-delete",on:{click:function(i){return i.preventDefault(),t.maybeDoBulkAction({action:"delete",selectedRows:"all"})}}},[t._v(" "+t._s(t.strings.deleteAllLinks)+" ")]):t._e()])]),t.showModal?s("link-assistant-confirmation-modal",{attrs:{selectedRows:t.selectedRows,strings:t.modalStrings},on:{doBulkAction:t.doBulkAction,closeModal:function(i){t.showModal=!1}}}):t._e()],1)},It=[];const Tt={components:{CoreTooltip:v,CoreWpTable:g,LinkAssistantConfirmationModal:f,LinkAssistantPhrase:w,SvgLinkExternal:_,SvgLinkSuggestion:z,SvgTrash:$},mixins:[b,y,h],data(){return{tableId:"aioseo-post-report-inbound-internal",linkType:"inboundInternal",strings:{deleteAllLinks:this.$t.sprintf(this.$t.__("Delete All %1$s Links",this.$td),this.$t.__("Inbound Internal",this.$td)),outboundSuggestions:this.$t.sprintf(this.$t.__("%1$s Link Suggestions",this.$td),this.$t.__("Inbound",this.$td))}}},computed:{columns(){return[{slug:"post_title",label:this.$t.__("Post Title",this.$td)},{slug:"phrase",label:this.$t.__("Phrase",this.$td)},{slug:"delete",width:"50px"}]},seeAllLinks(){return this.$t.sprintf(this.$t.__("See All %1$s %2$s Links",this.$td),this.post.links.inboundInternal.totals.total,this.$t.__("Inbound Internal",this.$td))}},methods:{maybeViewPost(t){var e,s;this.viewPost(((s=(e=t.context)==null?void 0:e.postType)==null?void 0:s.singular)||"Post")},maybeEditPost(t){var e,s;this.editPost(((s=(e=t.context)==null?void 0:e.postType)==null?void 0:s.singular)||"Post")},processPagination(t){this.pageNumber=t,!this.metabox&&(this.wpTableLoading=!0,this.processFetchTableData().then(()=>this.wpTableLoading=!1))}}},L={};var Ct=u(Tt,At,It,!1,Lt,null,null,null);function Lt(t){for(let e in L)this[e]=L[e]}const Ls=function(){return Ct.exports}();var Mt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("core-wp-table",{key:t.wpTableKey,class:{"link-assistant-inner-table":!t.postReport},attrs:{"bulk-options":t.bulkOptions,columns:t.columns,id:t.tableId,"initial-items-per-page":t.$aioseo.settings.tablePagination.linkAssistantPostsReport,"initial-page-number":t.pageNumber,loading:t.wpTableLoading,rows:t.rows,"show-pagination":!t.linksReport,"show-search":!1,"show-table-footer":t.postReport,totals:t.post.links.outboundInternal.totals,"show-items-per-page":""},on:{paginate:t.processPagination,"process-bulk-action":t.maybeDoBulkAction,"process-change-items-per-page":t.processChangeItemsPerPage},scopedSlots:t._u([{key:"post_title",fn:function(i){var n=i.row;return[n.context&&n.context.postTitle?s("span",[t._v(" "+t._s(n.context.postTitle)+" "),n.url.replace(/\/$/,"")===t.$aioseo.urls.home?s("span",[t._v("("+t._s(t.strings.frontPage)+")")]):t._e()]):t._e(),!n.context||!n.context.postTitle?s("span",[t._v(" "+t._s(n.url)+" "),n.url.replace(/\/$/,"")===t.$aioseo.urls.home?s("span",[t._v("("+t._s(t.strings.frontPage)+")")]):t._e()]):t._e(),n.context?s("div",{staticClass:"row-actions"},[s("span",{staticClass:"view"},[s("a",{attrs:{href:n.url,target:"_blank"}},[t._v(t._s(t.viewPost(n.context.postType.singular)))]),t._v(" | ")]),s("span",{staticClass:"edit"},[s("a",{attrs:{href:n.context.editLink,target:"_blank"}},[t._v(t._s(t.editPost(n.context.postType.singular)))])])]):t._e(),n.context?t._e():s("div",{staticClass:"row-actions"},[s("span",{staticClass:"view"},[s("a",{attrs:{href:n.url,target:"_blank"}},[t._v(t._s(t.strings.openUrl))])])])]}},{key:"phrase",fn:function(i){var n=i.row;return[s("link-assistant-phrase",{attrs:{phrase:n.phrase,phraseHtml:n.phrase_html,anchor:n.anchor,url:n.url,clickableAnchor:!0}})]}},{key:"created",fn:function(i){var n=i.column;return[t._v(" "+t._s(t.$moment.utc(n).tz(t.$moment.tz.guess()).format("MMMM D, YYYY"))+" ")]}},{key:"delete",fn:function(i){var n=i.index;return[s("core-tooltip",{attrs:{type:"action"},scopedSlots:t._u([{key:"tooltip",fn:function(){return[t._v(" "+t._s(t.strings.deleteLink)+" ")]},proxy:!0}],null,!0)},[s("svg-trash",{nativeOn:{click:function(o){return t.maybeDoBulkAction({action:"delete",selectedRows:n})}}})],1)]}}])}),t.postReport?t._e():s("div",{staticClass:"links-bottom"},[s("div",{staticClass:"links-bottom-left"},[t.post.links.outboundInternal.rows.length?s("base-button",{attrs:{type:"blue",tag:"button"},nativeOn:{click:function(i){return t.$emit("openSuggestions")}}},[s("svg-link-suggestion"),t._v(" "+t._s(t.strings.outboundSuggestions)+" ")],1):t._e(),t.post.links.outboundInternal.totals.total>5&&t.linksReport?s("div",[s("svg-link-external"),s("a",{staticClass:"link-view",attrs:{href:"#"},on:{click:function(i){return i.preventDefault(),t.openPostReport("outbound-internal")}}},[t._v(" "+t._s(t.seeAllLinks)+" ")])],1):t._e()],1),s("div",{staticClass:"links-bottom-right"},[t.post.links.outboundInternal.rows.length?s("a",{staticClass:"link-delete",on:{click:function(i){return i.preventDefault(),t.maybeDoBulkAction({action:"delete",selectedRows:"all"})}}},[t._v(" "+t._s(t.strings.deleteAllLinks)+" ")]):t._e()])]),t.showModal?s("link-assistant-confirmation-modal",{attrs:{selectedRows:t.selectedRows,strings:t.modalStrings},on:{doBulkAction:t.doBulkAction,closeModal:function(i){t.showModal=!1}}}):t._e()],1)},Et=[];const Bt={components:{CoreTooltip:v,CoreWpTable:g,LinkAssistantConfirmationModal:f,LinkAssistantPhrase:w,SvgLinkExternal:_,SvgLinkSuggestion:z,SvgTrash:$},mixins:[b,y,h],data(){return{tableId:"aioseo-post-report-outbound-internal",linkType:"outboundInternal",strings:{deleteAllLinks:this.$t.sprintf(this.$t.__("Delete All %1$s Links",this.$td),this.$t.__("Outbound Internal",this.$tdPro)),outboundSuggestions:this.$t.sprintf(this.$t.__("%1$s Link Suggestions",this.$td),this.$t.__("Outbound",this.$tdPro)),openUrl:this.$t.__("Open URL",this.$tdPro)}}},computed:{columns(){return[{slug:"post_title",label:this.$t.__("Post Title / URL",this.$tdPro)},{slug:"phrase",label:this.$t.__("Phrase",this.$td)},{slug:"delete",width:"50px"}]},seeAllLinks(){return this.$t.sprintf(this.$t.__("See All %1$s %2$s Links",this.$td),this.post.links.outboundInternal.totals.total,this.$t.__("Outbound Internal",this.$tdPro))}},methods:{processPagination(t){this.pageNumber=t,!this.metabox&&(this.wpTableLoading=!0,this.processFetchTableData().then(()=>this.wpTableLoading=!1))}}},M={};var Dt=u(Bt,Mt,Et,!1,Ot,null,null,null);function Ot(t){for(let e in M)this[e]=M[e]}const Ms=function(){return Dt.exports}(),K={mixins:[j],props:{post:{type:Object,required:!0},postIndex:{type:Number,required:!1},postId:{type:Number,required:!1},filteredSuggestionsOutbound:{type:Array,required:!1},postReport:{type:Boolean,default(){return!1}},linksReport:{type:Boolean,default(){return!1}},metabox:{type:Boolean,default(){return!1}}},beforeMount(){this.$bus.$on("updatingLinks",t=>{this.wpTableLoading=t}),this.pageNumber=this.suggestionType?this.linkAssistant.postReport[this.suggestionType].totals.page:1},data(){return{changeItemsPerPageSlug:"linkAssistantPostsReport",editablePhraseKey:0,activeSuggestionRow:-1,action:"",showModal:!1,selectedRows:[],bulkOptions:[{label:this.$t.__("Add Link",this.$tdPro),value:"add"},{label:this.$t.__("Description",this.$td),value:"dismiss"}],strings:{addLink:this.$t.__("Add Link",this.$tdPro),dismiss:this.$t.__("Dismiss Suggestion",this.$tdPro)}}},computed:{...m(["linkAssistant","currentPost"]),rows(){if(!this.metabox)return this.post.links[this.suggestionType].rows;const t=this.pageNumber===1?0:(this.pageNumber-1)*10;return this.suggestionType==="suggestionsOutbound"?this.filteredSuggestionsOutbound.slice(t,t+10):this.post.links[this.suggestionType].rows.slice(t,t+10)},modalStrings(){return this.action==="add"?{areYouSureSingle:this.$t.__("Are you sure you want to add this suggestion?",this.$tdPro),areYouSureMultiple:this.$t.__("Are you sure you want to add these suggestions?",this.$tdPro),areYouSureAll:this.$t.__("Are you sure you want to add all suggestions?",this.$tdPro),actionCannotBeUndone:this.$t.__("This action cannot be undone.",this.$tdPro),yesSingle:this.$t.__("Yes, I want to add this suggestion",this.$tdPro),yesMultiple:this.$t.__("Yes, I want to add these suggestions",this.$tdPro),yesAll:this.$t.__("Yes, I want to add all suggestions",this.$tdPro),noChangedMind:this.$t.__("No, I changed my mind",this.$tdPro)}:{areYouSureSingle:this.$t.__("Are you sure you want to dismiss this suggestion?",this.$tdPro),areYouSureMultiple:this.$t.__("Are you sure you want to dismiss these suggestions?",this.$tdPro),areYouSureAll:this.$t.__("Are you sure you want to dismiss all suggestions?",this.$tdPro),actionCannotBeUndone:this.$t.__("This action cannot be undone.",this.$tdPro),yesSingle:this.$t.__("Yes, I want to dismiss this suggestion",this.$tdPro),yesMultiple:this.$t.__("Yes, I want to dismiss these suggestions",this.$tdPro),yesAll:this.$t.__("Yes, I want to dismiss all suggestions",this.$tdPro),noChangedMind:this.$t.__("No, I changed my mind",this.$tdPro)}}},methods:{...N("linkAssistant",["suggestionDismiss","suggestionsBulk","fetchPostReport","fetchLinksReportInner","postSettingsUpdate"]),fetchData(t){this.$bus.$emit("updatingLinks",!0);const e={...t,additionalFilters:{postId:this.post.ID,postIndex:this.postIndex,type:this.suggestionType}},s=this.postReport?"fetchPostReport":"fetchLinksReportInner";return this[s](e).finally(()=>{this.$bus.$emit("updatingLinks",!1)})},toggleShowMorePhrases(t){if(this.activeSuggestionRow===t){this.activeSuggestionRow=-1;return}this.activeSuggestionRow=t},toggleShowMorePostTitles(t){if(this.activeSuggestionRow===t){this.activeSuggestionRow=-1;return}this.activeSuggestionRow=t},openPostReport(t,e){window.location.href=`#/post-report?postId=${this.postId}&initialTab=${t}&initialSuggestionTab=${e}`},saveModifiedPhrase(t){let e=null;this.linksReport&&(e=this.linkAssistant.linksReport.rows[this.postIndex].links[this.suggestionType].rows[t.postIndex]),this.postReport&&(e=this.linkAssistant.postReport[this.suggestionType].rows[t.postIndex]),this.metabox&&(e=this.currentPost.linkAssistant.links[this.suggestionType].rows[t.postIndex]),e.suggestions[t.phraseIndex].phrase_html!==t.phraseHtml&&(e.suggestions[t.phraseIndex].phrase=t.phrase,e.suggestions[t.phraseIndex].phrase_html=t.phraseHtml,e.suggestions[t.phraseIndex].anchor=t.anchor)},addLink(t,e){let s=null;if(this.suggestionType==="suggestionsInbound"){const n=`editablePhrase${e}`;s=this.$refs[n].selectedPhrase}if(this.suggestionType==="suggestionsOutbound"&&(s=this.selectedPostTitleIndex),s===!1||typeof s>"u"){console.error("Couldn't determine index of suggestion.");return}if(this.suggestionType==="suggestionsOutbound"){const n=l(t.suggestions[0].context.permalink),o=l(t.suggestions[s].context.permalink),r=new RegExp(`/${n}/`,"i"),a=t.suggestions[0].phrase_html.replace(r,o);t.suggestions[s].phrase_html=a,t.suggestions[s].anchor=t.suggestions[0].anchor}const i=t.suggestions[s];t.suggestions[s]=t.suggestions[0],t.suggestions[0]=i,this.maybeDoBulkAction({action:"add",selectedRows:t})},maybeDoBulkAction({action:t,selectedRows:e}){e===!1||e===void 0||!t||(this.action=t,this.selectedRows=e,this.showModal=!0)},doBulkAction(){if(this.showModal=!1,!this.selectedRows)return;if(this.action==="dismiss"&&typeof this.selectedRows=="number"){this.doDismissSuggestion(this.selectedRows);return}if(this.selectedRows==="all"){this.$bus.$emit("updatingLinks",!0),this.suggestionsBulk({postIndex:this.postIndex,postId:this.post.ID||this.currentPost.id,action:this.action,suggestionType:this.suggestionType,suggestionRows:"all",linksReport:this.linksReport,postReport:this.postReport}).finally(()=>{this.$bus.$emit("updatingLinks",!1),this.$emit("linksUpdated"),this.refreshTable()});return}let t=null;if(this.linksReport&&(t=this.linkAssistant.linksReport.rows[this.postIndex].links[this.suggestionType].rows),this.postReport&&(t=this.linkAssistant.postReport[this.suggestionType].rows),this.metabox){if(this.action==="add"&&this.suggestionType!=="suggestionsInbound"){if(this.$bus.$emit("updatingLinks",!0),Array.isArray(this.selectedRows))this.selectedRows.forEach(s=>{this.editorAddSuggestion(s)});else{const s=this.selectedRows;this.editorAddSuggestion(s)}this.$bus.$emit("updatingLinks",!1);return}t=this.currentPost.linkAssistant.links[this.suggestionType].rows}const e=[];Array.isArray(this.selectedRows)?this.selectedRows.forEach(s=>{e.push(t[s])}):e.push(this.selectedRows),this.$bus.$emit("updatingLinks",!0),this.suggestionsBulk({postIndex:this.postIndex,postId:this.post.ID||this.currentPost.id,action:this.action,suggestionType:this.suggestionType,suggestionRows:e,linksReport:this.linksReport,postReport:this.postReport}).finally(()=>{this.$bus.$emit("updatingLinks",!1),this.$emit("linksUpdated"),this.refreshTable()})},doDismissSuggestion(t){this.$bus.$emit("updatingLinks",!0),this.suggestionDismiss({postIndex:this.postIndex,postId:this.post.ID||this.currentPost.id,suggestionId:t,linksReport:this.linksReport,postReport:this.postReport}).finally(()=>{this.$bus.$emit("updatingLinks",!1),this.$emit("linksUpdated"),this.refreshTable()})},editorAddSuggestion(t){x()&&this.blockEditorAddSuggestion(t),R()&&this.classicEditorAddSuggestion(t)},blockEditorAddSuggestion(t){let e=null,s=null;if(isNaN(t)?this.rows.forEach((p,P)=>{p.suggestions[0].id===t.suggestions[0].id&&(e=p,s=P)}):(s=t,e=this.rows[t]),!e||s===!1)return;this.$bus.$emit("updatingLinks",!0);const i=window.wp.data.select("core/block-editor").getBlocks(),n=e.suggestions[0].original_phrase_html.trim(),o=this.findTargetBlock(i,n);if(!o){this.$bus.$emit("updatingLinks",!1);return}const r=window.wp.data.select("core/block-editor").getBlock(o);if(!r){this.$bus.$emit("updatingLinks",!1);return}const a=l(e.suggestions[0].anchor.trim());let c=new RegExp(`(${a})`,"i");const d=e.suggestions[0].phrase_html.trim(),k=l(n);c=new RegExp(`(${k})`,"i"),window.wp.data.dispatch("core/block-editor").updateBlockAttributes(o,{content:r.attributes.content.replace(c,d)}).then(()=>{this.$delete(this.rows,s)}).catch(p=>{console.error("Couldn't add outbound link:",p)}).finally(()=>{this.postSettingsUpdate({postContent:window.wp.data.select("core/editor").getEditedPostContent(),skipNextRun:!0})})},classicEditorAddSuggestion(t){let e=null,s=null;if(isNaN(t)?this.rows.forEach((p,P)=>{p.suggestions[0].id===t.suggestions[0].id&&(e=p,s=P)}):(s=t,e=this.rows[t]),!e||s===!1)return;this.$bus.$emit("updatingLinks",!0);let i="",n=null,o=null;if(document.querySelector("#wp-content-wrap.tmce-active")?(n=window.tinyMCE.get("content"),i=n.getContent({format:"raw"})):(o=document.querySelector("textarea#content"),i=o?o.value:""),!i){this.$bus.$emit("updatingLinks",!1);return}const r=e.suggestions[0].original_phrase_html.trim(),a=l(r),c=l(e.suggestions[0].anchor.trim());let d=new RegExp(`(${c})`,"i");const k=e.suggestions[0].phrase_html.trim();d=new RegExp(`(${a})`,"i"),i=i.replace(d,k),n?n.setContent(i):o.value=i,this.$delete(this.rows,s),this.postSettingsUpdate({postContent:i,skipNextRun:!0}).finally(()=>{this.$bus.$emit("updatingLinks",!1)})}}};var Ht=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"aioseo-phrase-editor"},[t.context?s("div",{staticClass:"context"},[s("p",[s("strong",{staticClass:"context-label"},[t._v(t._s(t.strings.context)+":")])]),s("p",{domProps:{innerHTML:t._s(t.context)}})]):t._e(),s("base-editor",{ref:"linkEditor",attrs:{"auto-link":{url:t.url,phrase:t.phrase},"show-toolbar":"","allow-tags":""},on:{input:function(i){return t.$emit("input",i)},"selection-change":t.selectionChange}}),s("div",{staticClass:"action-buttons"},[s("base-button",{attrs:{type:"blue",size:"small"},on:{click:function(i){return t.$emit("saveEditor")}}},[t._v(" "+t._s(t.strings.saveChanges)+" ")]),s("base-button",{attrs:{type:"gray",size:"small"},on:{click:function(i){return t.$emit("closeEditor")}}},[t._v(" "+t._s(t.strings.cancel)+" ")])],1)],1)},qt=[];const Nt={components:{BaseEditor:et},props:{phrase:{type:String,required:!0},url:{type:String,required:!0},context:{type:String,required:!1}},data(){return{strings:{saveChanges:this.$t.__("Save Changes",this.$tdPro),cancel:this.$t.__("Cancel",this.$tdPro),context:this.$t.__("Context",this.$tdPro)}}},mounted(){this.$refs.linkEditor.setPhrase(this.phrase);const t=document.querySelector(".ql-autoLink");t&&(t.innerHTML='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="7" x2="11" y1="7" y2="11"></line><path class="ql-even ql-stroke" d="M8.9,4.577a3.476,3.476,0,0,1,.36,4.679A3.476,3.476,0,0,1,4.577,8.9C3.185,7.5,2.035,6.4,4.217,4.217S7.5,3.185,8.9,4.577Z"></path><path class="ql-even ql-stroke" d="M13.423,9.1a3.476,3.476,0,0,0-4.679-.36,3.476,3.476,0,0,0,.36,4.679c1.392,1.392,2.5,2.542,4.679.36S14.815,10.5,13.423,9.1Z"></path></svg>',t.classList.add("ql-disabled"))},methods:{getPhrase(){return this.$refs.linkEditor.getPhrase()},getPhraseHtml(){return this.$refs.linkEditor.getPhraseHtml()},getPhraseWithFormats(){return this.$refs.linkEditor.getPhraseWithFormats()},selectionChange({range:t,source:e}){const s=document.querySelector(".ql-autoLink");s&&(!t||!t.length||e!=="user")?s.classList.add("ql-disabled"):s.classList.remove("ql-disabled")}}},E={};var Yt=u(Nt,Ht,qt,!1,Ft,null,null,null);function Ft(t){for(let e in E)this[e]=E[e]}const Ut=function(){return Yt.exports}();var jt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"aioseo-editable-phrase"},[s("div",{staticClass:"domains-report-editable-phrase"},[t.showEditor!==t.rowIndex?s("div",[s("div",{staticClass:"editable-phrase first-phrase",on:{click:function(i){return t.openEditor(t.rowIndex,0)}}},[t.linkSuggestion&&t.showingMorePhrases&&t.suggestionType!=="suggestionsOutbound"?s("input",{attrs:{type:"radio"},domProps:{checked:t.selectedPhrase===0},on:{click:function(i){i.stopPropagation(),t.selectedPhrase=0}}}):t._e(),s("link-assistant-phrase",{class:{hover:t.hoveringOver===0},attrs:{url:t.tooltipUrl(t.row,t.phrases[0]),phrase:t.phrases[0].phrase,phraseHtml:t.phrases[0].phrase_html,anchor:t.phrases[0].anchor},on:{mouseOver:function(i){t.hoveringOver=0},mouseLeave:function(i){t.hoveringOver=-1}},scopedSlots:t._u([{key:"icons",fn:function(){return[s("span",{staticClass:"icons"},[s("svg-pencil"),t.domainsReport?s("svg-trash",{nativeOn:{click:function(i){return function(n){return t.deleteLink(n,t.rowIndex,0)}.apply(null,arguments)}}}):t._e()],1)]},proxy:!0}],null,!1,2783923469)})],1),t.suggestionType!=="suggestionsOutbound"&&1<t.phrases.length&&t.showEditor!==t.rowIndex?s("div",{staticClass:"show-more-phrases"},[s("a",{attrs:{href:"#"},on:{click:function(i){i.preventDefault(),t.$emit("toggleShowMorePhrases",t.rowIndex),t.selectedPhrase=0}}},[s("div",[t._v(t._s(t.viewMorePhrasesLabel))]),s("svg-caret",{class:{rotated:t.showingMorePhrases}})],1)]):t._e(),s("transition-slide",{staticClass:"phrases-list",attrs:{tag:"div",active:t.showingMorePhrases&&t.suggestionType!=="suggestionsOutbound"}},t._l(t.phrases,function(i,n){return s("div",{key:n,staticClass:"editable-phrase-container"},[n?s("div",{staticClass:"editable-phrase selectable-phrase",on:{click:function(o){return t.openEditor(t.rowIndex,n)}}},[t.linkSuggestion&&t.showingMorePhrases?s("input",{attrs:{type:"radio"},domProps:{checked:n===t.selectedPhrase},on:{click:function(o){o.stopPropagation(),t.selectedPhrase=n}}}):t._e(),s("link-assistant-phrase",{class:{hover:n===t.hoveringOver},attrs:{url:t.tooltipUrl(t.row,t.phrases[0]),phrase:i.phrase,phraseHtml:i.phrase_html,anchor:i.anchor},on:{mouseOver:function(o){t.hoveringOver=n},mouseLeave:function(o){t.hoveringOver=-1}},scopedSlots:t._u([{key:"icons",fn:function(){return[s("div",{staticClass:"icons"},[s("svg-pencil"),t.domainsReport?s("svg-trash",{nativeOn:{click:function(o){return function(r){return t.deleteLink(r,t.rowIndex,n)}.apply(null,arguments)}}}):t._e()],1)]},proxy:!0}],null,!0)})],1):t._e()])}),0)],1):t._e(),t.showEditor===t.rowIndex?s("link-assistant-phrase-editor",{ref:"linkEditor",attrs:{value:t.phrases[this.phraseIndex].phrase,phrase:t.phrases[this.phraseIndex].phrase_html,url:t.url,context:t.phraseContext},on:{saveEditor:t.processModifiedPhrase,closeEditor:function(i){t.showEditor=-1,t.hoveringOver=-1}}}):t._e()],1)])},zt=[];const Kt={components:{LinkAssistantPhrase:w,LinkAssistantPhraseEditor:Ut,SvgCaret:Y,SvgPencil:X,SvgTrash:$,TransitionSlide:F},props:{row:{type:Object,required:!0},rowIndex:{type:Number,default:0},activeRow:{type:Number,default:-1},postIndex:{type:Number,required:!1},suggestionType:{type:String,required:!1},selectedPostTitleIndex:{type:Number,required:!1,default(){return 0}},linkSuggestion:{type:Boolean,default(){return!1}},domainsReport:{type:Boolean,default(){return!1}}},data(){return{phraseIndex:-1,showEditor:-1,hoveringOver:-1,selectedPhrase:0}},computed:{...m(["linkAssistant","currentPost"]),phrases(){return this.linkSuggestion?this.row.suggestions.slice(0,10):this.row.links.slice(0,10)},url(){return this.domainsReport?this.phrases[this.phraseIndex].url:this.suggestionType==="suggestionsInbound"?this.row.context.permalink:this.suggestionType==="suggestionsOutbound"?this.row.suggestions[this.selectedPostTitleIndex].context.permalink:""},showingMorePhrases(){return 1<this.phrases.length&&this.activeRow===this.rowIndex},viewMorePhrasesLabel(){const t=1<this.phrases.length?this.phrases.length-1:0;return this.$t.sprintf(this.$t._n("%1$d more phrase","%1$d more phrases",t,this.$td),t)},phraseContext(){let t="",e="";if(this.linkSuggestion){const n=this.row.suggestions[this.phraseIndex];t=n.phrase.trim(),e=n.paragraph.trim()}else{const n=this.row.links[this.phraseIndex];t=n.phrase.trim(),e=n.paragraph.trim()}if(t===e)return"";const s=l(t),i=new RegExp(s,"i");return e.match(i)&&(e=e.replace(i,`<strong>${t}</strong>`)),e}},methods:{tooltipUrl(t,e){return this.domainsReport?e.url:this.suggestionType==="suggestionsInbound"?t.permalink:this.suggestionType==="suggestionsOutbound"&&t.suggestions[this.selectedPostTitleIndex]?t.suggestions[this.selectedPostTitleIndex].context.permalink:""},openEditor(t,e){this.phraseIndex=e,this.showEditor=t},processModifiedPhrase(){this.showEditor=-1,this.hoveringOver=-1;const t=this.$refs.linkEditor.getPhrase(),e=this.$refs.linkEditor.getPhraseHtml(),s=this.$refs.linkEditor.getPhraseWithFormats();let i="";s.ops.forEach(n=>{n.attributes&&n.attributes.link&&(i=i+n.insert)}),i&&this.$emit("saveModifiedPhrase",{phrase:t,phraseHtml:e,anchor:i,postIndex:this.rowIndex,phraseIndex:this.phraseIndex})},deleteLink(t,e,s){t.stopPropagation(),t.preventDefault(),this.$emit("delete",{postIndex:e,linkIndex:s})}}},B={};var Vt=u(Kt,jt,zt,!1,Wt,null,null,null);function Wt(t){for(let e in B)this[e]=B[e]}const V=function(){return Vt.exports}();var Zt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"aioseo-link-suggestions-Inbound"},[s("core-wp-table",{key:t.wpTableKey,class:{"link-assistant-inner-table":!t.postReport},attrs:{"bulk-options":t.bulkOptions,columns:t.columns,id:t.tableId,"initial-items-per-page":t.$aioseo.settings.tablePagination.linkAssistantPostsReport,"initial-page-number":t.pageNumber,loading:t.wpTableLoading,rows:t.rows,"show-pagination":!t.linksReport,"show-search":!1,"show-table-footer":t.postReport,totals:t.post.links.suggestionsInbound.totals,"show-items-per-page":""},on:{paginate:t.processPagination,"process-bulk-action":t.maybeDoBulkAction,"process-change-items-per-page":t.processChangeItemsPerPage},scopedSlots:t._u([{key:"post_title",fn:function(i){var n=i.row;return[s("strong",[s("a",{staticClass:"edit-link",attrs:{href:n.context.permalink,target:"_blank"}},[t._v(t._s(n.context.postTitle))])]),s("div",{staticClass:"row-actions"},[s("span",{staticClass:"view"},[s("a",{attrs:{href:n.context.permalink,target:"_blank"}},[t._v(t._s(t.viewPost(n.context.postType.singular)))]),t._v(" | ")]),s("span",{staticClass:"edit"},[s("a",{attrs:{href:n.context.editLink,target:"_blank"}},[t._v(t._s(t.editPost(n.context.postType.singular)))]),t._v(" | ")]),s("span",{staticClass:"dismiss"},[s("a",{attrs:{href:"#"},on:{click:function(o){return o.preventDefault(),t.maybeDoBulkAction({action:"dismiss",selectedRows:n})}}},[t._v(t._s(t.strings.dismiss))])])])]}},{key:"phrase",fn:function(i){var n=i.row,o=i.index;return[s("link-assistant-editable-phrase",{ref:"editablePhrase"+o,attrs:{row:n,rowIndex:o,activeRow:t.activeSuggestionRow,postIndex:t.postIndex,suggestionType:t.suggestionType,linkSuggestion:""},on:{hidePhrases:function(r){t.activeSuggestionRow=-1},toggleShowMorePhrases:t.toggleShowMorePhrases,saveModifiedPhrase:t.saveModifiedPhrase}})]}},{key:"add_link",fn:function(i){var n=i.row,o=i.index;return[s("div",{staticClass:"add-link",on:{click:function(r){return r.preventDefault(),t.addLink(n,o)}}},[s("svg-circle-plus"),s("a",[t._v(t._s(t.strings.addLink))])],1)]}}])}),t.postReport?t._e():s("div",{staticClass:"links-bottom"},[s("div",{staticClass:"links-bottom-left"},[t.post.links.suggestionsInbound.totals.total>5&&t.linksReport?s("div",[s("svg-link-external"),s("a",{staticClass:"link-view",attrs:{href:"#"},on:{click:function(i){return i.preventDefault(),t.openPostReport("link-suggestions","suggestions-inbound")}}},[t._v(" "+t._s(t.seeAllSuggestions)+" ")])],1):t._e()]),s("div",{staticClass:"links-bottom-right"},[t.post.links.suggestionsInbound.rows.length?s("a",{staticClass:"link-delete",on:{click:function(i){return i.preventDefault(),t.maybeDoBulkAction({action:"dismiss",selectedRows:"all"})}}},[t._v(" "+t._s(t.strings.dismissAllSuggestions)+" ")]):t._e()])]),t.showModal?s("link-assistant-confirmation-modal",{attrs:{strings:t.modalStrings,selectedRows:t.selectedRows},on:{closeModal:function(i){t.showModal=!1},doBulkAction:t.doBulkAction}}):t._e()],1)},Gt=[];const Jt={components:{CoreWpTable:g,LinkAssistantConfirmationModal:f,LinkAssistantEditablePhrase:V,SvgCirclePlus:U,SvgLinkExternal:_},mixins:[y,K,h],data(){return{tableId:"aioseo-post-report-inbound-suggestions",suggestionType:"suggestionsInbound",strings:{dismissAllSuggestions:this.$t.sprintf(this.$t.__("Dismiss All %1$s Suggestions",this.$tdPro),this.$t.__("Inbound Internal",this.$tdPro)),noSuggestions:this.$t.sprintf(this.$t.__("You currently don't have any %1$s Suggestions!",this.$tdPro),this.$t.__("Inbound Internal",this.$tdPro))}}},computed:{columns(){return[{slug:"post_title",label:this.$t.__("Post Title",this.$td)},{slug:"spacer",width:"30px"},{slug:"phrase",label:this.$t.__("Phrase",this.$td)},{slug:"add_link",width:"150px"}]},seeAllSuggestions(){return this.$t.sprintf(this.$t.__("See All %1$s %2$s Suggestions",this.$tdPro),this.post.links.suggestionsInbound.totals.total,this.$t.__("Inbound Internal",this.$tdPro))}},methods:{processPagination(t){this.pageNumber=t,!this.metabox&&(this.wpTableLoading=!0,this.processFetchTableData().then(()=>this.wpTableLoading=!1))}}},D={};var Qt=u(Jt,Zt,Gt,!1,Xt,null,null,null);function Xt(t){for(let e in D)this[e]=D[e]}const ts=function(){return Qt.exports}();var ss=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"aioseo-post-title-selector"},[s("div",{staticClass:"post-title first-post-title",on:{mouseover:function(i){t.hoveringOver=0},mouseleave:function(i){t.hoveringOver=-1}}},[t.showingMorePostTitles?s("input",{attrs:{type:"radio"},domProps:{checked:t.selectedPostTitleIndex===0},on:{click:function(i){return i.stopPropagation(),t.selectDifferentPostTitle(0)}}}):t._e(),s("span",{staticClass:"post-title-text"},[t._v(t._s(t.postTitles[0]))]),s("div",{staticClass:"row-actions",class:{hover:t.hoveringOver===0}},[s("span",{staticClass:"view"},[s("a",{attrs:{href:t.row.suggestions[0].context.permalink,target:"_blank"}},[t._v(t._s(t.viewPost(t.row.suggestions[0].context.postType.singular)))]),t._v(" | ")]),s("span",{staticClass:"edit"},[s("a",{attrs:{href:t.row.suggestions[0].context.editLink,target:"_blank"}},[t._v(t._s(t.editPost(t.row.suggestions[0].context.postType.singular)))])])])]),1<t.postTitles.length?s("div",{staticClass:"show-more-post-titles"},[s("a",{attrs:{href:"#"},on:{click:function(i){i.preventDefault(),t.$emit("toggleShowMorePhrases",t.rowIndex),t.selectDifferentPostTitle(0)}}},[s("div",[t._v(t._s(t.viewMorePostTitlesLabel))]),s("svg-caret",{class:{rotated:t.showingMorePostTitles}})],1)]):t._e(),s("transition-slide",{staticClass:"post-titles-list",attrs:{tag:"div",active:t.showingMorePostTitles}},t._l(t.postTitles,function(i,n){return s("div",{key:n,staticClass:"post-title post-title-container"},[n?s("div",{staticClass:"selectable-post-title",on:{mouseover:function(o){t.hoveringOver=n},mouseleave:function(o){t.hoveringOver=-1}}},[t.showingMorePostTitles?s("input",{attrs:{type:"radio"},domProps:{checked:n===t.selectedPostTitleIndex},on:{click:function(o){return o.stopPropagation(),t.selectDifferentPostTitle(n)}}}):t._e(),s("span",{staticClass:"post-title-text"},[t._v(t._s(t.postTitles[n]))]),s("div",{staticClass:"row-actions",class:{hover:n===t.hoveringOver}},[s("span",{staticClass:"view"},[s("a",{attrs:{href:t.row.suggestions[n].context.permalink,target:"_blank"}},[t._v(t._s(t.viewPost(t.row.suggestions[n].context.postType.singular)))]),t._v(" | ")]),s("span",{staticClass:"edit"},[s("a",{attrs:{href:t.row.suggestions[n].context.editLink,target:"_blank"}},[t._v(t._s(t.editPost(t.row.suggestions[n].context.postType.singular)))])])])]):t._e()])}),0)],1)},es=[];const is={components:{SvgCaret:Y,TransitionSlide:F},mixins:[y],props:{row:{type:Object,required:!0},rowIndex:{type:Number,default:0},activeRow:{type:Number,default:-1},postIndex:{type:Number,required:!1},suggestionType:{type:String,required:!1}},data(){return{selectedPostTitleIndex:-1,hoveringOver:-1}},computed:{...m(["linkAssistant","currentPost"]),postTitles(){const t=[];return this.row.suggestions.forEach(e=>{t.includes[e.context.postTitle]||t.push(e.context.postTitle)}),t.slice(0,10)},showingMorePostTitles(){return 1<this.postTitles.length&&this.activeRow===this.rowIndex},viewMorePostTitlesLabel(){const t=1<this.postTitles.length?this.postTitles.length-1:0;return this.$t.sprintf(this.$t._n("%1$d more post","%1$d more posts",t,this.$td),t)}},methods:{selectDifferentPostTitle(t){this.selectedPostTitleIndex!==t&&(this.selectedPostTitleIndex=t,this.$emit("postTitleIndexChanged",t))}}},O={};var ns=u(is,ss,es,!1,os,null,null,null);function os(t){for(let e in O)this[e]=O[e]}const rs=function(){return ns.exports}();var as=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"aioseo-link-suggestions-outbound"},[s("core-wp-table",{key:t.wpTableKey,class:{"link-assistant-inner-table":!t.postReport},attrs:{"bulk-options":t.bulkOptions,columns:t.columns,id:t.tableId,"initial-items-per-page":t.$aioseo.settings.tablePagination.linkAssistantPostsReport,"initial-page-number":t.pageNumber,loading:t.wpTableLoading,rows:t.rows,"show-pagination":!t.linksReport,"show-search":!1,"show-table-footer":t.postReport,totals:t.post.links.suggestionsOutbound.totals,"show-items-per-page":""},on:{paginate:t.processPagination,"process-bulk-action":t.maybeDoBulkAction,"process-change-items-per-page":t.processChangeItemsPerPage},scopedSlots:t._u([{key:"post_title",fn:function(i){var n=i.row,o=i.index;return[s("link-assistant-post-title-selector",{ref:"postTitleSelector"+o,attrs:{row:n,rowIndex:o,activeRow:t.activeSuggestionRow,postIndex:t.postIndex,suggestionType:t.suggestionType,linkSuggestion:""},on:{hidePhrases:function(r){t.activeSuggestionRow=-1},toggleShowMorePhrases:t.toggleShowMorePhrases,saveModifiedPhrase:t.saveModifiedPhrase,postTitleIndexChanged:function(r){return t.selectedPostTitleIndex=r}}})]}},{key:"phrase",fn:function(i){var n=i.row,o=i.index;return[s("link-assistant-editable-phrase",{attrs:{row:n,rowIndex:o,activeRow:t.activeSuggestionRow,postIndex:t.postIndex,suggestionType:t.suggestionType,selectedPostTitleIndex:t.selectedPostTitleIndex,linkSuggestion:""},on:{hidePhrases:function(r){t.activeSuggestionRow=-1},saveModifiedPhrase:t.saveModifiedPhrase}}),s("div",{staticClass:"row-actions"},[s("span",{staticClass:"dismiss"},[s("a",{attrs:{href:"#"},on:{click:function(r){return r.preventDefault(),t.maybeDoBulkAction({action:"dismiss",selectedRows:n})}}},[t._v(t._s(t.strings.dismiss))])])])]}},{key:"add_link",fn:function(i){var n=i.row,o=i.index;return[s("div",{staticClass:"add-link",on:{click:function(r){return r.preventDefault(),t.addLink(n,o)}}},[s("svg-circle-plus"),s("a",[t._v(t._s(t.strings.addLink))])],1)]}}])}),t.postReport?t._e():s("div",{staticClass:"links-bottom"},[s("div",{staticClass:"links-bottom-left"},[t.post.links.suggestionsOutbound.totals.total>5&&t.linksReport?s("div",[s("svg-link-external"),s("a",{staticClass:"link-view",attrs:{href:"#"},on:{click:function(i){return i.preventDefault(),t.openPostReport("link-suggestions","suggestions-outbound")}}},[t._v(" "+t._s(t.seeAllSuggestions)+" ")])],1):t._e()]),s("div",{staticClass:"links-bottom-right"},[t.filteredSuggestionsOutbound.length?s("a",{staticClass:"link-delete",on:{click:function(i){return i.preventDefault(),t.maybeDoBulkAction({action:"dismiss",selectedRows:"all"})}}},[t._v(" "+t._s(t.strings.dismissAllSuggestions)+" ")]):t._e()])]),t.showModal?s("link-assistant-confirmation-modal",{attrs:{strings:t.modalStrings,selectedRows:t.selectedRows},on:{closeModal:function(i){t.showModal=!1},doBulkAction:t.doBulkAction}}):t._e()],1)},ls=[];const us={components:{CoreWpTable:g,LinkAssistantConfirmationModal:f,LinkAssistantEditablePhrase:V,LinkAssistantPostTitleSelector:rs,SvgCirclePlus:U,SvgLinkExternal:_},mixins:[K,h],data(){return{tableId:"aioseo-post-report-outbound-suggestions",suggestionType:"suggestionsOutbound",selectedPostTitleIndex:0,strings:{dismissAllSuggestions:this.$t.sprintf(this.$t.__("Dismiss All %1$s Suggestions",this.$tdPro),this.$t.__("Outbound Internal",this.$tdPro)),noSuggestions:this.$t.sprintf(this.$t.__("You currently don't have any %1$s Suggestions!",this.$tdPro),this.$t.__("Outbound Internal",this.$tdPro))}}},computed:{columns(){return[{slug:"phrase",label:this.$t.__("Phrase",this.$td)},{slug:"spacer",width:"30px"},{slug:"post_title",label:this.$t.__("Post Title",this.$td)},{slug:"add_link",width:"150px"}]},seeAllSuggestions(){return this.$t.sprintf(this.$t.__("See All %1$s %2$s Suggestions",this.$tdPro),this.post.links.suggestionsOutbound.totals.total,this.$t.__("Outbound Internal",this.$tdPro))}},methods:{processPagination(t){this.pageNumber=t,!this.metabox&&(this.wpTableLoading=!0,this.processFetchTableData().then(()=>this.wpTableLoading=!1))}}},H={};var cs=u(us,as,ls,!1,ds,null,null,null);function ds(t){for(let e in H)this[e]=H[e]}const ps=function(){return cs.exports}();var hs=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"aioseo-link-suggestions"},[t.internalOptions.internal.dismissedAlerts.suggestions?t._e():s("core-alert",{staticClass:"description",attrs:{type:"blue","show-close":""},on:{"close-alert":t.dismissAlert}},[s("span",{domProps:{innerHTML:t._s(t.strings.description)}})]),s("core-main-tabs",{key:t.tabsKey,attrs:{internal:"",tabs:t.tabs,active:t.activeTab,showSaveButton:!1},on:{changed:t.processChangeTab},scopedSlots:t._u([{key:"md-tab-icon",fn:function(i){var n=i.tab;return[s(n.icon,{tag:"component",class:[{warning:n.data.warning}]})]}}])}),s("div",{staticClass:"link-suggestions-container"},[s("keep-alive",[t.activeTab==="suggestions-outbound"?s("outbound",{attrs:{post:t.post,postIndex:t.postIndex,postId:t.postId,filteredSuggestionsOutbound:t.filteredSuggestionsOutbound,linksReport:t.linksReport,postReport:t.postReport,metabox:t.metabox},on:{linksUpdated:function(i){t.tabsKey++,t.$emit("linksUpdated")}}}):t._e()],1),s("keep-alive",[t.activeTab==="suggestions-inbound"?s("inbound",{attrs:{post:t.post,postIndex:t.postIndex,postId:t.postId,linksReport:t.linksReport,postReport:t.postReport,metabox:t.metabox},on:{linksUpdated:function(i){t.tabsKey++,t.$emit("linksUpdated")}}}):t._e()],1)],1)],1)},gs=[];const _s={components:{CoreAlert:tt,CoreMainTabs:st,Inbound:ts,Outbound:ps,SvgLinkInternalInbound:G,SvgLinkInternalOutbound:J},mixins:[b],props:{filteredSuggestionsOutbound:{type:Array,required:!0},initialTab:{type:String,required:!1},showAlert:{type:Boolean,default(){return!1}}},data(){return{tabsKey:0,activeTab:"suggestions-inbound",strings:{description:this.$t.sprintf(this.$t.__("Below you can add inbound and outbound internal links based on %1$s's smart suggestions. These suggestions are generated in the background, which requires some time to complete. %2$s",this.$tdPro),"AIOSEO",this.$links.getDocLink(this.$constants.GLOBAL_STRINGS.learnMore,"linkAssistant",!0))}}},computed:{...m("linkAssistant",["internalOptions"]),...W("linkAssistant",["getLinksReportCounts"]),tabs(){return[{slug:"suggestions-inbound",icon:"svg-link-internal-inbound",name:this.$t.sprintf("%1$s %2$s",this.metabox?this.post.links.suggestionsInbound.totals.total:this.getLinksReportCounts[this.postIndex].suggestionsInbound,this.$t.__("Inbound Internal Suggestions",this.$tdPro))},{slug:"suggestions-outbound",icon:"svg-link-internal-outbound",name:this.$t.sprintf("%1$s %2$s",this.metabox?this.filteredSuggestionsOutbound.length:this.getLinksReportCounts[this.postIndex].suggestionsOutbound,this.$t.__("Outbound Internal Suggestions",this.$tdPro))}]}},methods:{processChangeTab(t){this.activeTab=t,this.$emit("suggestionsTabChanged",t)},dismissAlert(){this.internalOptions.internal.dismissedAlerts.suggestions=!0,this.$http.get(this.$links.restUrl("link-assistant/data/dismiss-alert")).catch(t=>console.log("Could not dismiss suggestions alert:",t))}},beforeMount(){this.initialTab&&(this.activeTab=this.initialTab)}},q={};var fs=u(_s,hs,gs,!1,ks,null,null,null);function ks(t){for(let e in q)this[e]=q[e]}const Es=function(){return fs.exports}();export{Ts as L,y as P,z as S,Cs as a,Ls as b,Ms as c,Es as d,Is as e,f,V as g};
